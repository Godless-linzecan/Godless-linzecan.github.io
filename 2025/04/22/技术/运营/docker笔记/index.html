<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>docker笔记 | Godless</title><meta name="keywords" content="docker"><meta name="author" content="Godless"><meta name="copyright" content="Godless"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="docker笔记"><meta name="application-name" content="docker笔记"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="docker笔记"><meta property="og:url" content="http://example.com/2025/04/22/技术/运营/docker笔记/index.html"><meta property="og:site_name" content="Godless"><meta property="og:description" content="Docker学习笔记名词：容器虚拟化技术 理念简介不懂网上有很多课，自己去弄明白再看下面 解决了运行环境和配置问题的软件容器，方便做持续集成并有助于整体发布的容器虚拟化技术。 基于Go语言实现的云开源项目（牛逼） 容器与虚拟机的比较传统虚拟机传统虚拟机技术基于安装在主操作系统上的虚拟机管理系统(如:"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://image.godless.site/i/1/2025/05/23/682f5159c1e1f.jpg?_r_=a1d7ea70-65c0-d5d4-27fd-89b4941b3df6"><meta property="article:author" content="Godless"><meta property="article:tag" content="[&quot;个人博客&quot;]"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://image.godless.site/i/1/2025/05/23/682f5159c1e1f.jpg?_r_=a1d7ea70-65c0-d5d4-27fd-89b4941b3df6"><meta name="description" content="Docker学习笔记名词：容器虚拟化技术 理念简介不懂网上有很多课，自己去弄明白再看下面 解决了运行环境和配置问题的软件容器，方便做持续集成并有助于整体发布的容器虚拟化技术。 基于Go语言实现的云开源项目（牛逼） 容器与虚拟机的比较传统虚拟机传统虚拟机技术基于安装在主操作系统上的虚拟机管理系统(如:"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://example.com/2025/04/22/%E6%8A%80%E6%9C%AF/%E8%BF%90%E8%90%A5/docker%E7%AC%94%E8%AE%B0/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2024/07/27/125766904/ba62475f396df9de3316a08ed9e65d86_5680958632268053399..png"},
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"加载完啦！","backTitle":"Godless博客"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: false,
  mainTone: undefined,
  authorStatus: {"skills":["🔍 分享与热心帮助","🔨 设计开发一条龙","🧱 团队小组发动机"]},
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"简","msgToSimplifiedChinese":"繁","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"这是","messageNext":"天前更新的，文章可能已经过期，不可靠"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: Godless","link":"链接: ","source":"来源: Godless","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'Godless',
  title: 'docker笔记',
  postAI: '',
  pageFillDescription: 'Docker学习笔记, 理念简介, 容器与虚拟机的比较, 传统虚拟机, Linux容器, 比较, DevOps, 镜像下载, docker的基本组成, 概论总结, Docker安装和配置, 卸载旧版本, 配置阿里云镜像源, 安装gcc和gcc-c++, 存储库（暂时没搞清楚）, 配置yum资源库, 安装Docker引擎, 启动docker引擎, 运行HelloWorld测试, 卸载docker, 阿里云镜像加速, 刷新配置, 配置成系统服务, 配置成自启动, Docker下载加速, 常用命令, 启动类命令, 帮助类命令, 镜像命令, 在远程仓库中搜索镜像, 下载镜像, 查看占据空间, 删除镜像, 虚悬镜像, 命令自动补全, Docker后台运行一个一直运行的容器, 容器命令, 基础, 修改容器名称, 启动交互式容器, 列出正在运行的容器, 删除容器, 查看容器日志, 查看容器内运行的进程, 查看容器内部细节, 进入正在运行的容器, 重新进入正在运行的容器, exec和attch的区别, 容器和宿主机文件拷贝, 导入和导出容器, 将容器生成新的镜像, 容器数据卷, Docker镜像, Docker镜像加载原理, 联合文件系统, bootfs和rootfs, 镜像分层, 镜像分层的优势, 容器层, Registry建立Docker仓库, Docker Registry, 环境搭建, 推送到私有仓库, 阿里云个人镜像私有仓库使用, 登录阿里云Docker Registry, 输入密码, 拉取镜像, 将镜像打上标签, 将镜像推送到Registry, Docker 安装 Mysql, Mysql 单机, 简单版 Mysql 5.7 安装, 实际应用版 Mysql 5.7安装, Mysql主从复制安装, 安装主服务器容器实例（端口号3307）：, 安装从服务器容器实例（端口号3308）：, 开始设置同步, 配置主数据库, 进入从数据库容器配置主从复制：, 主从复制测试：, Docker安装Redis, 拉取Redis6.0.8, 单机版安装, 实际应用版, Dockerfile, 构建过程, Dockerfile保留字, FROM, MAINTAINER, RUN, EXPOSE, WORKDIR, USER, ENV, VOLUME, ADD, COPY, CMD, ENTRYPOINT, 构建镜像, 虚悬镜像, Docker Desktop For Windows 安装, 安装wsl2, 启用虚拟机平台功能, 将 WSL 默认版本设置为 WSL2, 重启, 安装Ubuntu, docker数据迁移学习笔记名词容器虚拟化技术理念简介不懂网上有很多课自己去弄明白再看下面解决了运行环境和配置问题的软件容器方便做持续集成并有助于整体发布的容器虚拟化技术基于语言实现的云开源项目牛逼容器与虚拟机的比较传统虚拟机传统虚拟机技术基于安装在主操作系统上的虚拟机管理系统如和等创建虚拟机虚拟出各种硬件在虚拟机上安装从操作系统在从操作系统中安装部署各种应用缺点资源占用多冗余步骤多启动慢容器容器是在操作系统层面上实现虚拟化直接复用本地主机的操作系统而传统虚拟机则是在硬件层面实现虚拟化与传统的虚拟机相比优势体现为启动速度快占用体积小优点体积小启动快比较比较了和传统虚拟化方式的不同之处传统虚拟机技术是虚拟出一套硬件后在其上运行一个完整操作系统在该系统上再运行所需应用进程容器内的应用进程直接运行于宿主的内核容器内没有自己的内核且也没有进行硬件虚拟因此容器要比传统虚拟机更为轻便每个容器之间互相隔离每个容器有自己的文件系统容器间进程不会相互影响能区分计算资源硬件虚拟化是指在一台物理计算机上创建多个虚拟的计算机实例虚拟机每个虚拟机都能像独立的电脑一样运行自己的操作系统和程序这通常需要一个中间层叫来管理和分配物理硬件资源给这些虚拟机并确保它们之间相互隔离容器与之不同它不进行硬件级别的虚拟化也不需要为每个应用单独运行一个操作系统容器直接使用宿主机的内核但为应用程序提供了隔离的执行环境开发运维新一代开发工程师镜像下载区别最全的基本组成镜像就是一个只读的模板镜像可以用来创建容器一个镜像可以创建很多容器它也相当于是一个文件系统比如官方镜像就包含了完整的一套最小系统的文件系统相当于容器的源代码镜像文件类似于的类模板而容器实例类似于中出来的实例对象面对对象容器对象镜像类尚硅谷老师概论总结文档地址安装和配置卸载旧版本旧版本的引擎包可能叫做新版本的引擎包叫做配置阿里云镜像源和的是一样的道理也就是说配置安装软件时要去哪里个镜像文件夹里面找安装和这个的作用是用来自定义镜像的时候做的存储库暂时没搞清楚存储库在新主机上首次安装之前您需要设置存储库之后您可以从存储库安装和更新配置资源库安装提供功能配置的资源库地址官方地址比较慢不推荐在资源库中添加资源库阿里云镜像地址更新软件包索引创建缓存可选以后安装会快一些安装引擎安装最新版本的引擎客户端是引擎是客户端此时默认安装的引擎客户端都是最新版本如果要安装指定版本查询版本列表指定版本安装版启动引擎如果没有启动引擎那么执行查看版本号时只能看到引擎客户端的版本号启动引擎新版本的就是一个系统服务可以直接使用启动系统服务方式启动此时查看版本可以看到引擎版本号查看启动状态查看进程查看服务状态运行测试运行运行不起来看下面阿里云镜像加速或者配置别的镜像我是配置了网上推荐的每个月都是不一样的但是可以去那里使用的镜像加速配置没有问题卸载卸载步骤关闭服务使用删除引擎删除镜像容器卷自定义配置等文件阿里云镜像加速开启镜像仓库并复制加速器地址配置到中地址阿里云镜像源地址刷新配置刷新重启但是由于国内大量访问就算阿里云产商有阿里云镜像但是也用不了我也不知道为什么阿里云镜像不能用找了相关文章直接在浏览器搜索关键词最新更换镜像源找到镜像源配置到里面就行或者找的镜像用刷新配置刷新配置重启配置成系统服务由于在下载安装他好像已经帮我配置成系统服务了我就不做成笔记后面需要再说配置成自启动配置成自启动检查是否配置成自启动下载加速看清标题就是下载加速不是查询那些加速也就是说或能从远程镜像库中拉取镜像下来但是无法查询镜像有好的解决方案欢迎共同讨论方式使用阿里镜像加速目前时间是问题就是你本地使用阿里镜像加速是没啥作用了他限制了好像是只能阿里云的产品才能去通过阿里镜像加速登录阿里云进入工作台容器镜像服务镜像工具镜像加速器里面提供了一个加速器地址将该地址配置到中初次进来时没有文件直接创建该文件即可刷新配置刷新配置重启方式配置面板给的镜像加速方式配置代理科学上网使用配置在文件中加入以下内容这里虚拟机里面不可以写本地他只会指向他虚拟机里面的网络不会只想宿主机的网络因为宿主机科学上网但虚拟机不是科学上网所以无法访问要自己查一下自己宿主机的的然后给虚拟机访问记得关闭防火墙常用命令启动类命令启动停止重启查看状态查看运行进程设置开机自启动帮助类命令查看版本查看概要信息可以看到镜像仓库地址查看帮助文档查看具体命令帮助文档具体命令镜像命令列出本机主机的镜像参数列出所有镜像含历史镜像不会展示被删除的镜像只列出镜像过滤在远程仓库中搜索镜像镜像名称参数过滤例子数量只展示前几项例子下载镜像镜像名不加镜像会默认拉取最新镜像查看占据空间会列出占据空间删除镜像镜像名可以使用空格分隔删除多个镜像镜像镜像镜像删除所有镜像所有筛选虚悬镜像仓库名标签都是的镜像俗称虚悬镜像遇见的会生成虚悬镜像的是在自己构建镜像时配置错误导致出现虚悬镜像虚悬镜像是没有任何作用的要删掉命令自动补全自动补全没有去做自己可以去配这个我是直接复制别人文档的可以去试一下我是不想我的内存太多东西而且有需要我可以自己查复制地址支持命令自动补全功能当输入镜像名前几位时可以按键自动补全镜像名称等如果镜像中有查看输入按下是否可以补全如果按下时没有自动补全可以按以下步骤操作检查是否安装了命令补全增强包检查有这个文件如果有目录但是没有文件为文件则需要安装检查是否安装了的自动补全检查文件夹下是否有开头的自动补全安装完后会在该文件夹下生成自动补全文件如果安装了则该文件夹下还会有文件如果已经安装了自动补全使用命令使其生效再次使用查看是否可以自动补全如果镜像中有查看输入按下是否可以补全如果有报错且报错中提示说明的配置文件没有生效需要一下对于安装的是版本配置文件为如果是自动安装的最新版为版本配置文件为再次使用查看是否可以自动补全如果镜像中有查看输入按下是否可以补全后台运行一个一直运行的容器就是后台一直运行不会退出时歇菜不断打印日志镜像名容器命令基础常用的参数为容器指定一个名称后台运行容器并返回容器也即启动守护式容器以交互模式运行容器通常与同时使用为容器重新分配一个伪输入终端通常与同时使用也即启动交互式容器前台有伪终端等待交互为容器添加环境变量随机端口映射将容器内暴露的所有端口映射到宿主机随机端口指定端口映射指定端口映射的几种不同形式端口映射例如配置监听地址例如随机分配端口例如指定多个端口映射例如修改容器名称原本名字目标名字启动交互式容器交互模式全称允许你与容器进行交互分配一个伪输入终端全称为容器分配一个伪终端镜像名称或交互的接口退出交互模式方式在交互中按输入即可确认即可退出宿主机退出后容器会停止方式使用快捷键退出后容器仍于正常运行启用守护式容器也就是后台运行容器名称注意事项如果使用启动容器后发现容器启动就会自动退出也就是说使用查不到运行的了已经退出了这也是由于镜像的默认行为的默认命令是当使用了上面命令时容器启动没有附加和发现没有交互式终端就会自动退出进程结束容器退出列出正在运行的容器列出所有正在运行的容器常用参数列出当前所有正在运行的容器历史上运行过的容器显示最近创建的容器显示最近个创建的容器静默模式只显示容器编号删除容器容器名或容器名或强制删除正在运行的容器删除所有容器查看容器日志容器名或查看容器内运行的进程容器名称或查看容器内部细节容器名称或者进入正在运行的容器无法通过容器名称进入容器重新进入正在运行的容器容器和的区别是在容器新建一个终端启用一个新的进程关闭一个进程但是不会导致容器退出是直接进入容器启动命令的终端不会新建一个进程退出关闭终端就会关闭一个进程导致容器退出如果有多个终端对一个容器执行就会出现像复制一个屏幕一样这边终端变化那边终端也跟着变化容器和宿主机文件拷贝容器内文件拷贝到宿主机中容器容器内路径目的主机路径宿主机文件拷贝到容器中主机路径容器容器内路径导入和导出容器导出容器的内容流作为一个归档文件对应命令从包中的内容创建一个新的文件系统再导入为镜像对应命令示例导出容器文件名导入文件自定义镜像用户自定义镜像名自定义镜像版本号导入导致变成了镜像将容器生成新的镜像提交的描述信息作者容器要创建的目标镜像名目标镜像名要小写挂载主机目录可能会出现报错解决方案在命令中加入参数目前没有遇到过就没多做深究容器数据卷卷就是目录或文件存在于一个或多个容器中由挂载到容器但不属于联合文件系统因此能够绕过提供一些用于持续存储或共享数据特性卷设计的目的就是数据的持久化完全独立于容器的生存周期因此不会在容器删除时删除其挂载的数据卷特点数据卷可以在容器之间共享或重用数据卷中的更改可以直接实施生效数据卷中的更改不会包含在镜像的更新中数据卷的生命周期一直持续到没有容器使用它为止运行一个带有容器卷存储功能的容器实例宿主机绝对路径目录容器内目录镜像名可以使用查看容器绑定的数据卷权限读写只读如果宿主机写入内容可以同步给容器内容器内可以读取容器卷的继承启动一个容器使用继承的容器卷映射配置镜像镜像是一种轻量级可执行的独立软件包它包含运行某个软件所需的所有内容我们把应用程序和配置依赖打包好行程一个可交付的运行环境包括代码运行时需要的库环境变量和配置文件等这个打包好的运行环境就是镜像文件镜像加载原理联合文件系统举个例子就是里面很轻量但是还是包含了一些我们自己构建的镜像里面想要拥有工具就要在构建的时候写清楚到时候我们镜像提交就把里面一个一个文件分别提交上去汇总成一个镜像文件拉取的时候也是一样一层一层下载下来下文照抄别人文章可以自己看看中的文件存储驱动叫做最早支持的是它实际上由一层一层的文件系统组成这种层级的文件系统叫联合文件系统文件系统是一种分层轻量级并且高性能的文件系统它支持对文件系统的修改作为一次提交来一层层的叠加同时可以将不同目录挂载到同一个虚拟文件系统下文件系统是镜像的基础镜像可以通过分层来进行集成基于基础镜像可以制作具体的应用镜像特性一次同时加载多个文件系统但从外面看起来只能看到一个文件系统联合加载会把各层文件系统叠加起来这样最终的文件系统会包含所有底层的文件和目录后来出现的版本中除了还支持等和主要包含和主要是引导加载刚启动时会加载文件系统在镜像的最底层是引导文件系统这一层与我们典型的系统是一样的包含加载器和内核当加载完成之后整个内核就都在内存中了此时内存的使用权已经由转交给内核此时系统也会卸载在之上包含的就是典型系统中的等标准目录和文件就是各种不同的操作系统发行版比如等镜像底层层次对于一个精简的可以很小只需要包括最基本的命令工具和程序库就可以了因为底层直接使用的自己只需要提供就可以所以对于不同的发行版基本是一致的会有差别不同的发行版可以共用有差别的镜像分层支持扩展现有镜像创建新的镜像新镜像是从镜像一层一层叠加生成的例如直接在镜像上构建安装安装容器启动时运行镜像创建过程镜像分层的优势镜像分层的一个最大好处就是共享资源方便复制迁移方便复用容器层当容器启动时一个新的可写层将被加载到镜像的顶部这一层通常被称为容器层容器层之下的都叫镜像层所有对容器的改动无论添加删除还是修改文件都只会发生在容器层中只有容器层是可写的容器层下面的所有镜像层都是只读的如图建立仓库是官方提供的工具用于构建私有镜像仓库环境搭建也是提供的一个镜像可以直接拉取运行步骤拉取镜像启动验证查看私服中的所有镜像会返回格式的所有镜像目录向私有仓库中上传镜像配置运行接收请求修改添加允许然后重启新版本的会立即生效的命令推送到私有仓库步骤添加一个对应的私有仓库地址的到私有仓库查看私有仓库总镜像目录验证拉取验证阿里云个人镜像私有仓库使用不能使用代理登录阿里云输入密码拉取镜像镜像版本号将镜像打上标签镜像版本号将镜像推送到镜像版本号安装以安装为例单机简单版安装简单的启动容器需要使用配置环境变量用户的密码简单版的会存在以下问题中文乱码没有容器卷映射启动容器后可以正常的连接创建数据库创建表插入数据但是插入中文则会报错例如创建数据库切换到创建表插入英文可以正常插入插入中文报错张三这是因为默认的字符集的问题可以在中使用以下命令查看数据库字符集返回的字符集中等都为字符集所以会报错而且因为启动容器时没有配置容器卷映射当容器意外被删时数据无法找回实际应用版安装启动容器并配置容器卷映射在下新建通过容器卷同步给实例解决中文乱码问题重启容器使得容器重新加载配置文件此时便解决了中文乱码中文插入报错问题而且因为启动时将容器做了容器卷映射将的配置映射到数据映射到日志映射到都映射到了宿主机实际目录所以即使删除了容器也不会产生太大影响只需要再执行一下启动容器命令容器卷还按相同位置进行映射所有的数据便都可以正常恢复主从复制安装安装主服务器容器实例端口号启动容器实例进入新建配置文件设置同一个局域网中需要唯一指定不需要同步的数据库名称开启二进制日志功能设置二进制日志使用内存大小事务设置使用的二进制日志格式二进制日志过期清理时间默认值为表示不自动清理跳过主从复制中遇到的所有错误或指定类型的错误避免端复制中断如错误是指一些主键重复错误是因为主从数据库数据不一致重启容器实例进入容器实例内安装从服务器容器实例端口号别人笔记有个问题配置文件挂载路径错误致命问题错误表现将宿主机的目录挂载到容器的这会覆盖容器内的默认配置目录导致服务无法启动原因分析镜像的默认配置文件路径为而挂载空目录到会导致容器内原有的配置文件被清空修复方案改为挂载到子目录专门存放自定义配置注意路径修正启动容器实例进入目录创建配置文件设置同一个局域网内需要唯一指定不需要同步的数据库名称开启二进制日志功能以备作为其它数据库实例的时使用设置二进制日志使用内存大小事务设置使用的二进制日志格式二进制日志过期清理时间默认值为表示不自动清理跳过主从复制中遇到的所有错误或指定类型的错误避免端复制中断如错误是指一些主键重复是因为主从数据库数据不一致配置中继日志表示将复制事件写进自己的二进制日志设置只读具有权限的用户除外修改完配置需要重启容器实例开始设置同步配置主数据库进入主数据库容器查看同步状态同步需要设置的参数进入查看主从同步状态主要查看返回结果的文件名当前位置主要查看返回结果的文件名当前位置这个到时候到给从数据库设置要设置一样的创建同步用户用来同步数据库创建数据同步用户授权进入从数据库容器配置主从复制进入从数据库容器进入数据库配置从数据库所属的主数据库格式宿主机主数据库配置的主从复制用户名主数据库配置的主从复制用户密码宿主机主数据库端口主数据库主从同步状态的文件名主数据库主从同步状态的连接失败重试时间间隔秒主数据库的地址主数据库的运行端口在主数据库创建的用于同步数据的用户账号在主数据库创建的用于同步数据的用户密码指定从数据库要复制数据的日志文件通过查看主数据的状态获取参数指定从数据库从哪个位置开始复制数据通过查看主数据的状态获取参数连接失败重试的时间间隔单位为秒这里等请查看自己宿主机的地址也就是说在虚拟机里面命令行输入结果里面的也就是查看主从同步状态再次查看主从同步状态都变为配置失败后想重新配置从数据库所属的主数据库会报错是还在运行也就是从数据库想去连接主数据库一直连接失败所以一直在重复尝试你不可以修改配置你要先停掉重新配置才行停止的线程或者直接停止所有线程主从复制测试在主数据库上新建库使用库新建表插入数据在从数据库上使用库查看记录安装拉取单机版安装实际应用版步骤宿主机创建目录在下创建文件主要修改以下几项配置开启密码验证可选允许外地连接需要注释掉绑定的关闭保护模式可选注释掉或者配置成因为该配置和中的参数冲突会导致容器一直启动失败开启数据持久化可选运行容器启动容器因为要使用自定义的配置文件所以需要指定容器运行的命令为容器内配置文件路径是用来构建镜像的文本文件是由一条条构建镜像所需的指令和参数构成的脚本构建步骤编写文件命令构建镜像依据镜像运行容器实例构建过程编写每条保留字指令都必须为大写字母且后面要跟随至少一个参数指令按照从上到下顺序执行表示注释每条指令都会创建一个新的镜像层并对镜像进行提交引擎执行的大致流程从基础镜像运行一个容器执行一条指令并对容器做出修改执行类似的操作提交一个新的镜像层再基于刚提交的镜像运行一个新容器执行中的下一条指令直到所有指令都执行完成保留字基础镜像当前新镜像是基于哪个镜像指定一个已经存在的镜像作为模版第一条必须是镜像名镜像维护者的姓名和邮箱地址非必须容器构建时需要运行的命令有两种格式格式等同于在终端操作的命令格式命令行命令格式格式可执行文件参数参数等价于是在时运行当前容器对外暴露出的端口要暴露的端口指定在创建容器后终端默认登录进来的工作目录指定该镜像以什么样的用户去执行如果不指定默认是一般不修改该配置用来在构建镜像过程中设置环境变量这个环境变量可以在后续的任何指令或其他指令中使用格式环境变量名环境变量值或者环境变量名值使用环境变量容器数据卷用于数据保存和持久化工作类似于的参数挂载点挂载点可以是一个路径也可以是数组数组中的每一项必须用双引号将宿主机目录下或远程文件的文件拷贝进镜像且会自动处理和解压压缩包类似拷贝文件和目录到镜像中将从构建上下文目录中源路径的文件目录复制到新的一层镜像内的目标路径位置源路径源文件或者源目录目标路径容器内的指定路径该路径不用事先建好如果不存在会自动创建指定容器启动后要干的事情有两种格式格式命令格式可执行文件参数参数参数列表格式参数参数与指令配合使用中如果出现多个指令只有最后一个生效会被之后的参数替换例如对于镜像执行以下命令会有不同的效果因为的中指定了所以直接时容器启动后会自动执行指定容器启动后执行此时指定的会覆盖掉中指定的是在时运行而是在时运行用来指定一个容器启动时要运行的命令类似于命令但是不会被后面的命令覆盖这些命令参数会被当做参数送给指令指定的程序可以和一起用一般是可变参数才会使用这里的等于是在给传参当指定了后的含义就发生了变化不再是直接运行期命令而是将的内容作为参数传递给指令它们两个组合会变成例如定参变参对于此构建成镜像后如果执行则容器启动后会执行则容器启动后会执行构建镜像创建名称为的文件示例编写完成之后将其构建成镜像命令注意定义的后面有个空格空格后面有个点新镜像名字虚悬镜像虚悬镜像仓库名标签名都是的镜像称为虚悬镜像在构建或者删除镜像时可能由于一些错误导致出现虚悬镜像例如构建时候没有镜像名列出的虚悬镜像虚悬镜像一般是因为一些错误而出现的没有存在价值可以删除删除所有的虚悬镜像安装注意以下要用管理员身份运行安装我的建议是跟着步骤做一遍和这个差不多看文档比较扎实点启用虚拟机平台功能将默认版本设置为重启安装数据迁移新建容器导出数据库用导出导入数据库宿主机进入命令行查看正在运行的容器查看数据库登入容器并导入数据库资料登入容器并导入数据库资料命令容器',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-09-13 20:57:33',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">Godless</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/TODO/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 任务</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Element/" style="font-size: 1.05rem;">Element<sup>2</sup></a><a href="/tags/Hexo/" style="font-size: 1.05rem;">Hexo<sup>1</sup></a><a href="/tags/Javcascript/" style="font-size: 1.05rem;">Javcascript<sup>1</sup></a><a href="/tags/Linux/" style="font-size: 1.05rem;">Linux<sup>1</sup></a><a href="/tags/Mixin/" style="font-size: 1.05rem;">Mixin<sup>1</sup></a><a href="/tags/PS/" style="font-size: 1.05rem;">PS<sup>1</sup></a><a href="/tags/Picgo/" style="font-size: 1.05rem;">Picgo<sup>1</sup></a><a href="/tags/TMS/" style="font-size: 1.05rem;">TMS<sup>2</sup></a><a href="/tags/Vue/" style="font-size: 1.05rem;">Vue<sup>3</sup></a><a href="/tags/Wxjava/" style="font-size: 1.05rem;">Wxjava<sup>1</sup></a><a href="/tags/docker/" style="font-size: 1.05rem;">docker<sup>1</sup></a><a href="/tags/idea/" style="font-size: 1.05rem;">idea<sup>1</sup></a><a href="/tags/nginx/" style="font-size: 1.05rem;">nginx<sup>1</sup></a><a href="/tags/ruoyi/" style="font-size: 1.05rem;">ruoyi<sup>3</sup></a><a href="/tags/%E5%85%B0%E7%A9%BA%E5%9B%BE%E5%BA%8A/" style="font-size: 1.05rem;">兰空图床<sup>1</sup></a><a href="/tags/%E6%8F%92%E4%BB%B6/" style="font-size: 1.05rem;">插件<sup>1</sup></a><a href="/tags/%E7%BC%96%E8%BE%91%E5%99%A8%E9%85%8D%E7%BD%AE/" style="font-size: 1.05rem;">编辑器配置<sup>2</sup></a><a href="/tags/%E8%8B%A5%E4%BE%9D/" style="font-size: 1.05rem;">若依<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/09/"><span class="card-archive-list-date">九月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/04/"><span class="card-archive-list-date">四月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">20</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%BF%90%E8%90%A5/" itemprop="url">运营</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/docker/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>docker</span></a></span></div></div><h1 class="post-title" itemprop="name headline">docker笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-04-21T20:05:08.000Z" title="发表于 2025-04-22 04:05:08">2025-04-22</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-09-13T12:57:33.058Z" title="更新于 2025-09-13 20:57:33">2025-09-13</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">10k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>36分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="docker笔记"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为广东"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>广东</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://image.godless.site/i/1/2025/05/23/682f5159c1e1f.jpg?_r_=a1d7ea70-65c0-d5d4-27fd-89b4941b3df6"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://example.com/2025/04/22/%E6%8A%80%E6%9C%AF/%E8%BF%90%E8%90%A5/docker%E7%AC%94%E8%AE%B0/"><header><a class="post-meta-categories" href="/categories/%E8%BF%90%E8%90%A5/" itemprop="url">运营</a><a href="/tags/docker/" tabindex="-1" itemprop="url">docker</a><h1 id="CrawlerTitle" itemprop="name headline">docker笔记</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">Godless</span><time itemprop="dateCreated datePublished" datetime="2025-04-21T20:05:08.000Z" title="发表于 2025-04-22 04:05:08">2025-04-22</time><time itemprop="dateCreated datePublished" datetime="2025-09-13T12:57:33.058Z" title="更新于 2025-09-13 20:57:33">2025-09-13</time></header><h1 id="Docker学习笔记"><a href="#Docker学习笔记" class="headerlink" title="Docker学习笔记"></a>Docker学习笔记</h1><p>名词：容器虚拟化技术</p>
<h2 id="理念简介"><a href="#理念简介" class="headerlink" title="理念简介"></a>理念简介</h2><p>不懂网上有很多课，自己去弄明白再看下面</p>
<p>解决了<strong>运行环境和配置问题</strong>的<strong>软件容器</strong>，方便做持续集成并有助于整体发布的容器虚拟化技术。</p>
<p>基于Go语言实现的云开源项目（牛逼）</p>
<h2 id="容器与虚拟机的比较"><a href="#容器与虚拟机的比较" class="headerlink" title="容器与虚拟机的比较"></a>容器与虚拟机的比较</h2><h3 id="传统虚拟机"><a href="#传统虚拟机" class="headerlink" title="传统虚拟机"></a>传统虚拟机</h3><p>传统虚拟机技术基于安装在主操作系统上的虚拟机管理系统(如:VirtualBox和VMWare等)，创建虚拟机(虚拟出各种硬件)，在虚拟机上安装从操作系统，在从操作系统中安装部署各种应用。</p>
<p>缺点：</p>
<ul>
<li>资源占用多</li>
<li>冗余步骤多</li>
<li>启动慢</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.godless.site/i/1/2025/05/23/682f4d8f03cfd.png" alt="6806adab1d7d5"></p>
<h3 id="Linux容器"><a href="#Linux容器" class="headerlink" title="Linux容器"></a>Linux容器</h3><p>Docker 容器是在操作系统层面上实现虚拟化，直接复用本地主机的操作系统，而<strong>传统虚拟机则是在硬件层面实现虚拟化</strong>。与传统的虚拟机相比，Docker优势体现为启动速度快、占用体积小。</p>
<p>优点：</p>
<ul>
<li>体积小</li>
<li>启动快</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.godless.site/i/1/2025/05/23/682f4d9e04b71.png" alt="6806adb04e351"></p>
<h3 id="比较"><a href="#比较" class="headerlink" title="比较"></a>比较</h3><p>比较了 Docker 和传统虚拟化方式的不同之处:</p>
<ul>
<li>传统虚拟机技术是虚拟出一套硬件后，在其上运行一个完整操作系统，在该系统上再运行所需应用进程</li>
<li>容器内的应用进程直接运行于宿主的内核，容器内没有自己的内核且也<strong>没有进行硬件虚拟</strong>。因此容器要比传统虚拟机更为轻便。每个容器之间互相隔离，每个容器有自己的文件系统，容器间进程不会相互影响，能区分计算资源。</li>
</ul>
<blockquote>
<p>硬件虚拟化是指在一台物理计算机上创建多个虚拟的计算机实例（虚拟机），每个虚拟机都能像独立的电脑一样运行自己的操作系统和程序。这通常需要一个中间层，叫Hypervisor，来管理和分配物理硬件资源给这些虚拟机，并确保它们之间相互隔离。</p>
<p>容器与之不同，它不进行硬件级别的虚拟化，也不需要为每个应用单独运行一个操作系统。容器直接使用宿主机的内核，但为应用程序提供了隔离的执行环境。</p>
</blockquote>
<h2 id="DevOps"><a href="#DevOps" class="headerlink" title="DevOps"></a>DevOps</h2><blockquote>
<p>开发&#x2F;运维(DevOps)新一代开发工程师</p>
</blockquote>
<h2 id="镜像下载"><a href="#镜像下载" class="headerlink" title="镜像下载"></a>镜像下载</h2><p><a target="_blank" rel="noopener" href="https://mirrors.aliyun.com/centos/7.9.2009/isos/x86_64/?spm=a2c6h.25603864.0.0.3483f5advZ3Qsv">https://mirrors.aliyun.com/centos/7.9.2009/isos/x86_64/?spm=a2c6h.25603864.0.0.3483f5advZ3Qsv</a></p>
<p>区别：dvd最全</p>
<h2 id="docker的基本组成"><a href="#docker的基本组成" class="headerlink" title="docker的基本组成"></a>docker的基本组成</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.godless.site/i/1/2025/05/23/682f4e3fe9601.png" alt="6808eb8ac74f0"></p>
<blockquote>
<p>Docker 镜像(lmage)就是一个<strong>只读</strong>的模板。镜像可以用来创建 Docker 容器，<strong>一个镜像可以创建很多容器</strong>。</p>
<p>它也相当于是一个root文件系统。比如官方镜像 centos:7 就包含了完整的一套 centos:7 最小系统的 root 文件系统</p>
<p>相当于容器的“源代码”，<strong>docker镜像文件类似于Java的类模板，而docker容器实例类似于java中new出来的实例对象</strong>。</p>
</blockquote>
<table>
<thead>
<tr>
<th>Docker</th>
<th>面对对象</th>
</tr>
</thead>
<tbody><tr>
<td>容器</td>
<td>对象</td>
</tr>
<tr>
<td>镜像</td>
<td>类</td>
</tr>
</tbody></table>
<p>尚硅谷老师：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.godless.site/i/1/2025/05/23/682f4e50aad29.png" alt="6808ecf02eb00"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.godless.site/i/1/2025/05/23/682f4e5e03965.png" alt="6808ed6f9e723"></p>
<h3 id="概论总结"><a href="#概论总结" class="headerlink" title="概论总结"></a>概论总结</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.godless.site/i/1/2025/05/23/682f4e6f7cd7e.png" alt="6808edb9a9570"></p>
<p>文档地址：<a target="_blank" rel="noopener" href="https://docs.docker.com/engine/install/centos/">https://docs.docker.com/engine/install/centos/</a></p>
<h2 id="Docker安装和配置"><a href="#Docker安装和配置" class="headerlink" title="Docker安装和配置"></a>Docker安装和配置</h2><h3 id="卸载旧版本"><a href="#卸载旧版本" class="headerlink" title="卸载旧版本"></a>卸载旧版本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-engine </span><br></pre></td></tr></table></figure>

<blockquote>
<p>旧版本的Docker引擎包可能叫做：<code>docker</code>、<code>docker-engine</code>。</p>
<p>新版本的Docker引擎包叫做：<code>docker-ce</code></p>
</blockquote>
<h3 id="配置阿里云镜像源"><a href="#配置阿里云镜像源" class="headerlink" title="配置阿里云镜像源"></a>配置阿里云镜像源</h3><blockquote>
<p>yum和nodejs的npm是一样的道理，也就是说配置yum安装软件时要去哪里个镜像文件夹里面找</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br></pre></td></tr></table></figure>

<h3 id="安装gcc和gcc-c"><a href="#安装gcc和gcc-c" class="headerlink" title="安装gcc和gcc-c++"></a>安装gcc和gcc-c++</h3><blockquote>
<p>这个的作用是用来自定义镜像的时候做的</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum -y install gcc</span><br><span class="line">yum -y install gcc-c++</span><br></pre></td></tr></table></figure>

<h3 id="存储库（暂时没搞清楚）"><a href="#存储库（暂时没搞清楚）" class="headerlink" title="存储库（暂时没搞清楚）"></a>存储库（暂时没搞清楚）</h3><p>存储库：<a target="_blank" rel="noopener" href="https://docs.docker.com/engine/install/centos/#install-using-the-repository">https://docs.docker.com/engine/install/centos/#install-using-the-repository</a></p>
<p>在新主机上首次安装 Docker Engine 之前，您需要设置 Docker 存储库。之后，您可以从存储库安装和更新 Docker。</p>
<h3 id="配置yum资源库"><a href="#配置yum资源库" class="headerlink" title="配置yum资源库"></a>配置yum资源库</h3><p>安装<code>yum-config-manager</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum-util提供yum-config-manager功能 </span></span><br><span class="line"><span class="built_in">sudo</span> yum install -y yum-utils</span><br></pre></td></tr></table></figure>



<p>配置docker的资源库地址：</p>
<p>官方地址：（比较慢，不推荐）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在yum资源库中添加docker资源库</span></span><br><span class="line"><span class="built_in">sudo</span> yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure>

<p>阿里云镜像地址：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure>

<p>更新yum软件包索引（创建缓存）（可选）：</p>
<p>以后安装会快一些</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum makecache fast</span><br></pre></td></tr></table></figure>



<h3 id="安装Docker引擎"><a href="#安装Docker引擎" class="headerlink" title="安装Docker引擎"></a>安装Docker引擎</h3><p>安装最新版本的Docker引擎、Docker客户端：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker-ce是Docker引擎，docker-ce-cli是客户端</span></span><br><span class="line"><span class="built_in">sudo</span> yum install docker-ce docker-ce-cli containerd.io docker-compose-plugin</span><br></pre></td></tr></table></figure>

<p>此时，默认安装的docker引擎、客户端都是最新版本。</p>
<p>如果要安装指定版本：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询版本列表</span></span><br><span class="line">yum list docker-ce --showduplicates | <span class="built_in">sort</span> -r</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定版本安装17.09.0.ce版</span></span><br><span class="line"><span class="comment"># sudo yum install docker-ce-&lt;VERSION_STRING&gt; docker-ce-cli-&lt;VERSION_STRING&gt; containerd.io docker-compose-plugin</span></span><br><span class="line"><span class="built_in">sudo</span> yum install docker-ce-17.09.0.ce docker-ce-cli-17.09.0.ce containerd.io docker-compose-plugin</span><br></pre></td></tr></table></figure>



<h3 id="启动docker引擎"><a href="#启动docker引擎" class="headerlink" title="启动docker引擎"></a>启动docker引擎</h3><p>如果没有启动Docker引擎，那么执行 <code>docker version</code>查看版本号时，只能看到 <code>Client: Docker Engine</code>（Docker引擎客户端）的版本号。</p>
<p>启动Docker引擎：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">新版本的Docker就是一个系统服务，可以直接使用启动系统服务方式启动</span></span><br><span class="line">systemctl start docker</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">此时查看docker版本，可以看到Server: Docker Engine（Docker引擎）版本号</span></span><br><span class="line">docker version</span><br></pre></td></tr></table></figure>

<p>查看启动状态</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep docker <span class="comment">#查看进程</span></span><br><span class="line">systemctl status docker <span class="comment"># 查看服务状态</span></span><br></pre></td></tr></table></figure>



<h3 id="运行HelloWorld测试"><a href="#运行HelloWorld测试" class="headerlink" title="运行HelloWorld测试"></a>运行HelloWorld测试</h3><p>运行HelloWorld：</p>
<blockquote>
<p>运行不起来看下面：阿里云镜像加速或者配置别的镜像，我是配置了网上推荐的，每个月都是不一样的，但是可以去1Panel那里使用1Panel的镜像加速。2025-5-20配置：<a target="_blank" rel="noopener" href="https://docker.1panel.live没有问题./">https://docker.1panel.live没有问题。</a></p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run hello-world</span><br></pre></td></tr></table></figure>



<h3 id="卸载docker"><a href="#卸载docker" class="headerlink" title="卸载docker"></a>卸载docker</h3><p>卸载Docker步骤：</p>
<p>关闭服务 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop docker</span><br></pre></td></tr></table></figure>

<p> 使用<code>yum</code>删除docker引擎 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum remove docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure>

<p> 删除镜像、容器、卷、自定义配置等文件 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo rm -rf /var/lib/docker</span><br><span class="line">sudo rm -rf /var/lib/containerd</span><br></pre></td></tr></table></figure>

<h3 id="阿里云镜像加速"><a href="#阿里云镜像加速" class="headerlink" title="阿里云镜像加速"></a>阿里云镜像加速</h3><p><a target="_blank" rel="noopener" href="https://cr.console.aliyun.com/cn-shenzhen/instances/mirrors">https://cr.console.aliyun.com/cn-shenzhen/instances/mirrors</a></p>
<p>开启镜像仓库并复制加速器地址</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.godless.site/i/1/2025/05/23/682f4ecba2ae4.png" alt="680a42e938a1d"></p>
<p>配置到docker中：</p>
<p>地址<code>/etc/docker/daemon.json</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;阿里云镜像源地址.com&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#刷新配置</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl daemon-reload <span class="comment">#刷新</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl restart docker <span class="comment"># 重启docker</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>但是由于国内大量访问，就算阿里云产商有阿里云镜像，但是也用不了，我也不知道为什么阿里云镜像不能用</p>
<p>找了相关文章，直接在浏览器搜索关键词docker最新更换镜像源找到镜像源配置到docker里面就行</p>
<p>或者找1Panel的镜像用：<a target="_blank" rel="noopener" href="https://docker.1panel.live/">https://docker.1panel.live</a></p>
</blockquote>
<h3 id="刷新配置"><a href="#刷新配置" class="headerlink" title="刷新配置"></a>刷新配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload <span class="comment"># 刷新配置</span></span><br><span class="line">systemctl restart docker <span class="comment"># 重启docker</span></span><br></pre></td></tr></table></figure>



<h3 id="配置成系统服务"><a href="#配置成系统服务" class="headerlink" title="配置成系统服务"></a>配置成系统服务</h3><p>由于在下载安装docker，他好像已经帮我配置成系统服务了，我就不做成笔记，后面需要再说。</p>
<h3 id="配置成自启动"><a href="#配置成自启动" class="headerlink" title="配置成自启动"></a>配置成自启动</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">enable</span> docker <span class="comment"># 配置成自启动</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl is-enabled docker <span class="comment"># 检查是否配置成自启动</span></span><br></pre></td></tr></table></figure>



<h2 id="Docker下载加速"><a href="#Docker下载加速" class="headerlink" title="Docker下载加速"></a>Docker下载加速</h2><blockquote>
<p>看清标题，就是下载加速，不是查询search…那些加速，也就是说<code>docker pull</code>或<code>docker run </code>能从远程镜像库中拉取镜像下来，但是无法<code>docker search</code>查询镜像。有好的解决方案欢迎共同讨论。</p>
</blockquote>
<p>方式1：使用阿里镜像加速</p>
<p>目前时间是2025-5-21，问题就是你本地使用阿里镜像加速是没啥作用了，他限制了，好像是只能阿里云的产品才能去通过阿里镜像加速。</p>
<p>登录阿里云，进入 <code>工作台</code> -&gt; <code>容器镜像服务</code> -&gt; <code>镜像工具</code> -&gt; <code>镜像加速器</code>。</p>
<p>里面提供了一个加速器地址：<code>https://xxxxx.mirror.aliyuncs.com</code>，将该地址配置到docker中：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初次进来时没有/etc/docker/daemon.json文件，直接创建该文件即可</span></span><br><span class="line">vi /etc/docker/daemon.json</span><br></pre></td></tr></table></figure>

<p>刷新配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl daemon-reload <span class="comment"># 刷新配置</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl restart docker <span class="comment"># 重启docker</span></span><br></pre></td></tr></table></figure>



<p>方式2：配置1Panel面板给的镜像加速</p>
<p><code>https://docker.1panel.live</code></p>
<p>方式3：配置代理</p>
<p>科学上网，使用docker配置</p>
<p>在<code>/etc/docker/daemon.json</code>文件中加入以下内容：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;registry-mirrors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;https://xxxxxxxxxxxxxx.mirror.aliyuncs.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;https://docker.1panel.live&quot;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;proxies&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;http-proxy&quot;</span><span class="punctuation">:</span><span class="string">&quot;http://127.0.0.1:10808&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;https-proxy&quot;</span><span class="punctuation">:</span><span class="string">&quot;http://127.0.0.1:10808&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;no-proxy&quot;</span><span class="punctuation">:</span><span class="string">&quot;localhost&quot;</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>这里<code>http://127.0.0.1:10808</code>虚拟机里面不可以写本地，他只会指向他虚拟机里面的网络，不会只想宿主机的网络，因为宿主机科学上网，但虚拟机不是科学上网所以无法访问，要自己查一下自己宿主机的ipv4的ip然后给虚拟机访问，记得关闭防火墙。</p>
</blockquote>
<h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><h3 id="启动类命令"><a href="#启动类命令" class="headerlink" title="启动类命令"></a>启动类命令</h3><p>启动docker</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start docker</span><br></pre></td></tr></table></figure>

<p>停止docker</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop docker</span><br></pre></td></tr></table></figure>

<p>重启docker</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure>

<p>查看状态</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl status docker</span><br><span class="line">ps -ef | grep docker <span class="comment"># 查看docker运行进程</span></span><br></pre></td></tr></table></figure>

<p>设置开机自启动</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> docker</span><br></pre></td></tr></table></figure>

<h3 id="帮助类命令"><a href="#帮助类命令" class="headerlink" title="帮助类命令"></a>帮助类命令</h3><p>查看docker版本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker version</span><br></pre></td></tr></table></figure>

<p>查看docker概要信息</p>
<blockquote>
<p>可以看到镜像仓库地址</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker info</span><br></pre></td></tr></table></figure>

<p>查看docker帮助文档</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker --<span class="built_in">help</span></span><br></pre></td></tr></table></figure>

<p>查看具体命令帮助文档</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker 具体命令 --<span class="built_in">help</span></span><br></pre></td></tr></table></figure>

<h3 id="镜像命令"><a href="#镜像命令" class="headerlink" title="镜像命令"></a>镜像命令</h3><p>列出本机主机的镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure>

<p>参数：</p>
<ul>
<li><code>-a</code>：列出所有镜像（含历史镜像）（不会展示被删除的镜像）</li>
<li><code>-q</code>：只列出镜像ID</li>
<li><code>-f</code>：过滤</li>
</ul>
<h3 id="在远程仓库中搜索镜像"><a href="#在远程仓库中搜索镜像" class="headerlink" title="在远程仓库中搜索镜像"></a>在远程仓库中搜索镜像</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search 镜像名称</span><br></pre></td></tr></table></figure>

<p>参数：</p>
<ul>
<li><p><code>-f</code>：过滤。例子：<code>docker search ubuntu --filter &quot;stars=1000&quot;</code></p>
</li>
<li><p><code>--limit 数量</code>：只展示前几项。例子：<code>docker search ubuntu --limit 5</code></p>
</li>
</ul>
<h3 id="下载镜像"><a href="#下载镜像" class="headerlink" title="下载镜像"></a>下载镜像</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull 镜像名[:tag]</span><br></pre></td></tr></table></figure>

<p>不加镜像tag会默认拉取最新镜像</p>
<h3 id="查看占据空间"><a href="#查看占据空间" class="headerlink" title="查看占据空间"></a>查看占据空间</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker system <span class="built_in">df</span></span><br></pre></td></tr></table></figure>

<p>会列出：Images、Containers、Local Volumes、Build Cache占据空间</p>
<h3 id="删除镜像"><a href="#删除镜像" class="headerlink" title="删除镜像"></a>删除镜像</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi 镜像名/ID</span><br></pre></td></tr></table></figure>

<p>可以使用空格分隔，删除多个镜像：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi 镜像1 镜像2 镜像3</span><br></pre></td></tr></table></figure>

<p>删除所有镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi -f $(docker images -qa)</span><br></pre></td></tr></table></figure>

<ul>
<li><code>-q</code>：id</li>
<li><code>-a</code>：所有</li>
<li><code>-f</code>：筛选</li>
</ul>
<h3 id="虚悬镜像"><a href="#虚悬镜像" class="headerlink" title="虚悬镜像"></a>虚悬镜像</h3><p>仓库名、标签都是<code>&lt;none&gt;</code>的镜像，俗称虚悬镜像（dangling image）。</p>
<blockquote>
<p>遇见的会生成虚悬镜像的是在自己构建镜像时配置错误，导致出现虚悬镜像，虚悬镜像是没有任何作用的，要删掉</p>
</blockquote>
<h3 id="命令自动补全"><a href="#命令自动补全" class="headerlink" title="命令自动补全"></a>命令自动补全</h3><blockquote>
<p>自动补全没有去做，自己可以去配，这个我是直接复制别人文档的，可以去试一下，我是不想我的内存太多东西，而且有需要我可以自己查，复制地址：<a target="_blank" rel="noopener" href="https://www.yuque.com/tmfl/cloud/naxbau">https://www.yuque.com/tmfl/cloud/naxbau</a></p>
</blockquote>
<p>docker支持命令自动补全功能，当输入镜像名前几位时，可以按<code>tab</code>键自动补全镜像名称、tag等。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如果镜像中有ubuntu，查看输入ub按下tab是否可以补全</span></span><br><span class="line">docker run ub</span><br></pre></td></tr></table></figure>

<p>如果按下<code>tab</code>时没有自动补全，可以按以下步骤操作：</p>
<ol>
<li>检查是否安装了<code>bash-completion</code>（命令补全增强包）</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">检查有 /usr/share/bash-completion/bash_completion 这个文件</span></span><br><span class="line">ls /usr/share/bash-completion/bash_completion</span><br></pre></td></tr></table></figure>

<ol>
<li>如果有<code>/usr/share/bash-completion</code>目录，但是没有<code>/usr/share/bash-completion/bash_completion</code>文件（centos6为<code>/etc/bash_completion</code>文件），则需要安装<code>bash-completion</code></li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install bash-completion</span><br></pre></td></tr></table></figure>

<ol>
<li>检查是否安装了docker的自动补全</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">检查/usr/share/bash-completion/completions文件夹下是否有docker开头的自动补全</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker安装完后会在该文件夹下生成自动补全文件docker</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如果安装了docker-compose，则该文件夹下还会有 docker-compose文件</span></span><br><span class="line">ll /usr/share/bash-completion/completions/docker*</span><br></pre></td></tr></table></figure>

<ol>
<li>如果已经安装了docker自动补全，使用<code>source</code>命令使其生效</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /usr/share/bash-completion/completions/docker</span><br></pre></td></tr></table></figure>

<ol>
<li>再次使用<code>tab</code>查看是否可以自动补全</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如果镜像中有ubuntu，查看输入ub按下tab是否可以补全</span></span><br><span class="line">docker run ub</span><br></pre></td></tr></table></figure>

<ol>
<li>如果有报错，且报错中提示<code>_get_comp_words_by_ref: command not found</code>。说明<code>bash-completion</code>的配置文件没有生效，需要<code>source</code>一下</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">对于centos7，bash-completion安装的是2.x版本，配置文件为/usr/share/bash-completion/bash_completion</span></span><br><span class="line">source /usr/share/bash-completion/bash_completion</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如果是centos6，自动安装的bash-completion最新版为1.x版本，配置文件为/etc/bash_completion</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">bash /etc/bash_completion</span></span><br></pre></td></tr></table></figure>

<ol>
<li>再次使用<code>tab</code>查看是否可以自动补全</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如果镜像中有ubuntu，查看输入ub按下tab是否可以补全</span></span><br><span class="line">docker run ub</span><br></pre></td></tr></table></figure>

<h3 id="Docker后台运行一个一直运行的容器"><a href="#Docker后台运行一个一直运行的容器" class="headerlink" title="Docker后台运行一个一直运行的容器"></a>Docker后台运行一个一直运行的容器</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -d 就是后台一直运行，不会退出时歇菜， tail -f 不断打印日志</span></span><br><span class="line">docker run -d 镜像名 <span class="built_in">tail</span> -f /etc/bash</span><br></pre></td></tr></table></figure>

<h2 id="容器命令"><a href="#容器命令" class="headerlink" title="容器命令"></a>容器命令</h2><h3 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run [OPTIONS] IMAGE [COMMAND] [ARG...]</span><br></pre></td></tr></table></figure>

<p>常用的参数：</p>
<ul>
<li><p><code>--name</code>：为容器指定一个名称</p>
</li>
<li><p><code>-d</code>：后台运行容器并返回容器ID，也即启动守护式容器</p>
</li>
<li><p><code>-i</code>：以交互模式（interactive）运行容器，通常与<code>-t</code>同时使用</p>
</li>
<li><p><code>-t</code>：为容器重新分配一个伪输入终端（tty），通常与<code>-i</code>同时使用。也即启动交互式容器（前台有伪终端，等待交互）</p>
</li>
<li><p><code>-e</code>：为容器添加环境变量</p>
</li>
<li><p><code>-P</code>：随机端口映射。将容器内暴露的所有端口映射到宿主机随机端口</p>
</li>
<li><p><code>-p</code>：指定端口映射</p>
</li>
</ul>
<p><code>-p</code>指定端口映射的几种不同形式：</p>
<ul>
<li><p><code>-p hostPort:containerPort</code>：端口映射，例如<code>-p 8080:80</code></p>
</li>
<li><p><code>-p ip:hostPort:containerPort</code>：配置监听地址，例如 <code>-p 10.0.0.1:8080:80</code></p>
</li>
<li><p><code>-p ip::containerPort</code>：随机分配端口，例如 <code>-p 10.0.0.1::80</code></p>
</li>
<li><p><code>-p hostPort1:containerPort1 -p hostPort2:containerPort2</code>：指定多个端口映射，例如<code>-p 8080:80 -p 8888:3306</code></p>
</li>
</ul>
<h3 id="修改容器名称"><a href="#修改容器名称" class="headerlink" title="修改容器名称"></a>修改容器名称</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rename 原本名字 目标名字</span><br></pre></td></tr></table></figure>



<h3 id="启动交互式容器"><a href="#启动交互式容器" class="headerlink" title="启动交互式容器"></a>启动交互式容器</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -i 交互模式 全称：--interactive 允许你与容器进行交互</span></span><br><span class="line"><span class="comment"># -t 分配一个伪输入终端 全称： --tty 为容器分配一个伪终端</span></span><br><span class="line"><span class="comment"># ubuntu 镜像名称</span></span><br><span class="line"><span class="comment"># /bin/bash（或bash） shell交互的接口</span></span><br><span class="line">docker run -it ubuntu /bin/bash</span><br></pre></td></tr></table></figure>

<p>退出交互模式：</p>
<ul>
<li><p>方式1：</p>
<ul>
<li><pre><code class="language-bash"># 在交互中按输入exit即可确认即可退出宿主机
exit
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    退出后容器会停止</span><br><span class="line"></span><br><span class="line">- 方式2：</span><br><span class="line"></span><br><span class="line">  - 使用快捷键`ctrl` + `P` + `Q`</span><br><span class="line"></span><br><span class="line">    退出后容器仍于正常运行</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 启用守护式容器</span><br><span class="line"></span><br><span class="line">也就是后台运行</span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line">docker run -d 容器名称</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
</li>
</ul>
<p>注意事项：</p>
<p>如果使用<code>docker run -d ubuntu</code>启动容器后，发现容器启动就会自动退出</p>
<p>也就是说使用<code>docker ps</code>查不到运行的ubuntu了，已经退出了</p>
<p>这也是由于ubuntu镜像的默认行为，ubuntu的默认命令是&#x2F;bin&#x2F;bash，当使用了上面命令时，容器启动没有附加<code>-i</code>和<code>-t</code>，发现没有交互式终端就会自动退出，进程结束，容器退出。</p>
<h3 id="列出正在运行的容器"><a href="#列出正在运行的容器" class="headerlink" title="列出正在运行的容器"></a>列出正在运行的容器</h3><p>列出所有正在运行的容器：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps [OPTIONS]</span><br></pre></td></tr></table></figure>

<p>常用参数：</p>
<ul>
<li><p><code>-a</code>：列出当前所有正在运行的容器+历史上运行过的容器</p>
</li>
<li><p><code>-l</code>：显示最近创建的容器</p>
</li>
<li><p><code>-n</code>：显示最近n个创建的容器</p>
</li>
<li><p><code>-q</code>：静默模式，只显示容器编号</p>
</li>
</ul>
<h3 id="删除容器"><a href="#删除容器" class="headerlink" title="删除容器"></a>删除容器</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">rm</span> 容器名或ID</span><br><span class="line">docker <span class="built_in">rm</span> -f 容器名或ID <span class="comment"># 强制删除正在运行的容器</span></span><br><span class="line">docker <span class="built_in">rm</span> -f $(docker ps -a -q) <span class="comment"># 删除所有容器</span></span><br></pre></td></tr></table></figure>



<h3 id="查看容器日志"><a href="#查看容器日志" class="headerlink" title="查看容器日志"></a>查看容器日志</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker logs 容器名或ID</span><br></pre></td></tr></table></figure>



<h3 id="查看容器内运行的进程"><a href="#查看容器内运行的进程" class="headerlink" title="查看容器内运行的进程"></a>查看容器内运行的进程</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker top 容器名称或ID</span><br></pre></td></tr></table></figure>



<h3 id="查看容器内部细节"><a href="#查看容器内部细节" class="headerlink" title="查看容器内部细节"></a>查看容器内部细节</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect 容器名称或者ID</span><br></pre></td></tr></table></figure>



<h3 id="进入正在运行的容器"><a href="#进入正在运行的容器" class="headerlink" title="进入正在运行的容器"></a>进入正在运行的容器</h3><blockquote>
<p>无法通过容器名称进入</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it 容器ID bash</span><br></pre></td></tr></table></figure>



<h3 id="重新进入正在运行的容器"><a href="#重新进入正在运行的容器" class="headerlink" title="重新进入正在运行的容器"></a>重新进入正在运行的容器</h3><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker attach 容器ID</span><br></pre></td></tr></table></figure>



<h3 id="exec和attch的区别"><a href="#exec和attch的区别" class="headerlink" title="exec和attch的区别"></a>exec和attch的区别</h3><ul>
<li>exec是在容器新建一个终端，启用一个新的进程，<code>exit</code>关闭一个进程但是不会导致容器退出</li>
<li>attch是直接进入容器启动命令的终端，不会新建一个进程，<code>exit</code>退出关闭终端，就会关闭一个进程，导致容器退出</li>
</ul>
<p>如果有多个终端，对一个容器执行<code>dokcer attach</code>，就会出现像复制一个屏幕一样，这边终端变化，那边终端也跟着变化</p>
<h3 id="容器和宿主机文件拷贝"><a href="#容器和宿主机文件拷贝" class="headerlink" title="容器和宿主机文件拷贝"></a>容器和宿主机文件拷贝</h3><p>容器内文件拷贝到宿主机中</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">cp</span> 容器ID:容器内路径 目的主机路径</span><br></pre></td></tr></table></figure>

<p>宿主机文件拷贝到容器中</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">cp</span> 主机路径 容器ID:容器内路径</span><br></pre></td></tr></table></figure>



<h3 id="导入和导出容器"><a href="#导入和导出容器" class="headerlink" title="导入和导出容器"></a>导入和导出容器</h3><p><code>export</code>：导出容器的内容流作为一个tar归档文件（对应<code>import</code>命令）；</p>
<p><code>import</code>：从tar包中的内容创建一个新的文件系统再导入为镜像（对应<code>export</code>命令）；</p>
<p>示例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">导出</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker <span class="built_in">export</span> 容器ID &gt; tar文件名</span></span><br><span class="line">docker export abc &gt; aaa.tar</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">导入</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cat</span> tar文件 | docker import - 自定义镜像用户/自定义镜像名:自定义镜像版本号</span></span><br><span class="line">cat aaa.tar | docker import - test/mytest:1.0.1</span><br></pre></td></tr></table></figure>

<p>导入导致变成了镜像</p>
<h3 id="将容器生成新的镜像"><a href="#将容器生成新的镜像" class="headerlink" title="将容器生成新的镜像"></a>将容器生成新的镜像</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker commit -m=<span class="string">&quot;提交的描述信息&quot;</span> -a=<span class="string">&quot;作者&quot;</span> 容器ID 要创建的目标镜像名[:tag]</span><br></pre></td></tr></table></figure>

<p>目标镜像名要小写</p>
<p>Docker挂载主机目录，可能会出现报错：<code>cannot open directory .: Perission denied</code>。</p>
<p>解决方案：在命令中加入参数 <code>--privileged=true</code>。</p>
<blockquote>
<p>目前没有遇到过，就没多做深究</p>
</blockquote>
<h3 id="容器数据卷"><a href="#容器数据卷" class="headerlink" title="容器数据卷"></a>容器数据卷</h3><p>卷就是目录或文件，存在于一个或多个容器中，由docker挂载到容器，但不属于联合文件系统，因此能够绕过UnionFS，提供一些用于持续存储或共享数据。</p>
<p>特性：卷设计的目的就是数据的持久化，完全独立于容器的生存周期，因此Docker不会在容器删除时删除其挂载的数据卷。</p>
<p>特点：</p>
<ul>
<li><p>数据卷可以在容器之间共享或重用数据</p>
</li>
<li><p>卷中的更改可以直接实施生效</p>
</li>
<li><p>数据卷中的更改不会包含在镜像的更新中</p>
</li>
<li><p>数据卷的生命周期一直持续到没有容器使用它为止</p>
</li>
</ul>
<p>运行一个带有容器卷存储功能的容器实例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --privileged=true -v 宿主机绝对路径目录:容器内目录[rw | ro] 镜像名</span><br></pre></td></tr></table></figure>

<p>可以使用<code>docker inspect</code>查看容器绑定的数据卷。</p>
<p>权限：</p>
<ul>
<li><p><code>rw</code>：读写 </p>
</li>
<li><p><code>ro</code>：只读。如果宿主机写入内容，可以同步给容器内，容器内可以读取。</p>
</li>
</ul>
<p>容器卷的继承：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动一个容器</span></span><br><span class="line">docker run -it --privileged=true -v /tmp/test:/tmp/docker --name u1 ubuntu /bin/bash</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用 --volumes-from 继承 u1的容器卷映射配置</span></span><br><span class="line">docker run -it --privileged=true --volumes-from u1 --name u2 ubuntu</span><br></pre></td></tr></table></figure>

<h2 id="Docker镜像"><a href="#Docker镜像" class="headerlink" title="Docker镜像"></a>Docker镜像</h2><p>镜像是一种轻量级、可执行的独立软件包，它包含运行某个软件所需的所有内容，我们把应用程序和配置依赖打包好行程一个可交付的运行环境（包括代码、运行时需要的库、环境变量和配置文件等），这个打包好的运行环境就是image镜像文件。</p>
<h3 id="Docker镜像加载原理"><a href="#Docker镜像加载原理" class="headerlink" title="Docker镜像加载原理"></a>Docker镜像加载原理</h3><h4 id="联合文件系统"><a href="#联合文件系统" class="headerlink" title="联合文件系统"></a>联合文件系统</h4><blockquote>
<p>举个例子就是ubuntu里面很轻量，但是还是包含了一些，我们自己构建的镜像里面想要拥有vim工具就要在构建的时候写清楚，到时候我们镜像提交就把里面一个一个文件分别提交上去汇总成一个镜像文件。拉取的时候也是一样，一层一层下载下来。</p>
<p>下文照抄别人文章，可以自己看看。</p>
</blockquote>
<p>Docker 中的文件存储驱动叫做 storage driver。</p>
<p>Docker 最早支持的stotage driver是 AUFS，它实际上由一层一层的文件系统组成，这种层级的文件系统叫UnionFS。</p>
<p>联合文件系统（UnionFS）：Union 文件系统，是一种分层、轻量级并且高性能的文件系统，它支持对文件系统的修改作为一次提交来一层层的叠加，同时可以将不同目录挂载到同一个虚拟文件系统下（unite serveral directories into a single virtual filesystem）。</p>
<p>Union文件系统是Docker镜像的基础。镜像可以通过分层来进行集成，基于基础镜像可以制作具体的应用镜像。</p>
<p>特性：一次同时加载多个文件系统，但从外面看起来，只能看到一个文件系统，联合加载会把各层文件系统叠加起来，这样最终的文件系统会包含所有底层的文件和目录。</p>
<p>后来出现的docker版本中，除了AUFS，还支持OverlayFS、Btrfs、Device Mapper、VFS、ZFS等storage driver。</p>
<h4 id="bootfs和rootfs"><a href="#bootfs和rootfs" class="headerlink" title="bootfs和rootfs"></a>bootfs和rootfs</h4><p>bootfs（boot file system）主要包含 bootloader 和 kernel，bootloader主要是引导加载 kernel，Linux刚启动时会加载bootfs文件系统。</p>
<p>在Docker镜像的最底层是引导文件系统bootfs。这一层与我们典型的Linux&#x2F;Unix系统是一样的，包含boot加载器和内核。当boot加载完成之后整个内核就都在内存中了，此时内存的使用权已经由 bootfs 转交给内核，此时系统也会卸载 bootfs。</p>
<p>rootfs（root file system），在bootfs之上，包含的就是典型Linux系统中的 &#x2F;dev、&#x2F;proc、&#x2F;bin、&#x2F;etc等标准目录和文件。rootfs就是各种不同的操作系统发行版，比如Ubuntu、CentOS等。</p>
<p>docker镜像底层层次：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/jpeg/12911942/1652093445038-27095471-f01f-4978-a28f-d8e2df893dab.jpeg?x-oss-process=image/format,webp/interlace,1" alt="layer01.jpg"></p>
<p>对于一个精简的OS，rootfs可以很小，只需要包括最基本的命令、工具和程序库就可以了，因为底层直接使用Host的Kernel，自己只需要提供rootfs就可以。所以，对于不同的Linux发行版，bootfs基本是一致的，rootfs会有差别，不同的发行版可以共用bootfs。</p>
<p>有差别的rootfs：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/jpeg/12911942/1652093452907-392b879e-1f7b-478a-97ae-7c37cb9669b3.jpeg?x-oss-process=image/format,webp/interlace,1" alt="layer02.jpg"></p>
<h4 id="镜像分层"><a href="#镜像分层" class="headerlink" title="镜像分层"></a>镜像分层</h4><p>Docker支持扩展现有镜像，创建新的镜像。新镜像是从base镜像一层一层叠加生成的。</p>
<p>例如：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Version: 0.0.1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> debian  <span class="comment"># 直接在debain base镜像上构建</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">MAINTAINER</span> mylinux</span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update &amp;&amp; apt-get install -y emacs <span class="comment"># 安装emacs</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install -y apache2 <span class="comment"># 安装apache2</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;/bin/bash&quot;</span>] <span class="comment"># 容器启动时运行bash</span></span></span><br></pre></td></tr></table></figure>

<p>镜像创建过程：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/12911942/1652093459380-335e0f0e-1213-47d9-a17b-f49734699ef2.png?x-oss-process=image/format,webp" alt="layer03.png"></p>
<h4 id="镜像分层的优势"><a href="#镜像分层的优势" class="headerlink" title="镜像分层的优势"></a>镜像分层的优势</h4><p>镜像分层的一个最大好处就是共享资源，方便复制迁移，方便复用。</p>
<h4 id="容器层"><a href="#容器层" class="headerlink" title="容器层"></a>容器层</h4><p>当容器启动时，一个新的可写层将被加载到镜像的顶部，这一层通常被称为容器层，容器层之下的都叫镜像层。</p>
<p>所有对容器的改动，无论添加、删除、还是修改文件都只会发生在容器层中。</p>
<p>只有容器层是可写的，容器层下面的所有镜像层都是只读的。</p>
<p>如图：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/jpeg/12911942/1652093466220-a1c70673-7ca7-4025-9432-d89152439000.jpeg?x-oss-process=image/format,webp/interlace,1" alt="layer04.jpg"></p>
<h2 id="Registry建立Docker仓库"><a href="#Registry建立Docker仓库" class="headerlink" title="Registry建立Docker仓库"></a>Registry建立Docker仓库</h2><h3 id="Docker-Registry"><a href="#Docker-Registry" class="headerlink" title="Docker Registry"></a>Docker Registry</h3><p>Docker Registry是官方提供的工具，用于构建私有镜像仓库。</p>
<h3 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h3><p>Docker Registry也是Docker Hub提供的一个镜像，可以直接拉取运行。</p>
<p>步骤：</p>
<ol>
<li><p>拉取镜像</p>
<ol>
<li><pre><code class="language-bash">docker pull registry
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">2. 启动Docker Registry</span><br><span class="line"></span><br><span class="line">   1. ```bash</span><br><span class="line">      docker run -d -p 5000:5000 -v /app/myregistry:/tem/registry --privileged=true registry</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ol>
</li>
<li><p>验证（查看私服中的所有镜像）</p>
<ol>
<li><pre><code class="language-bash">curl http://192.168.xxx.xxx:5000/v2/_catalog
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Registry会返回json格式的所有镜像目录 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 向Registry私有仓库中上传镜像</span><br><span class="line"></span><br><span class="line">配置docker运行接收`http`请求</span><br><span class="line"></span><br><span class="line">修改`/etc/docker/daemon.json`，添加`insecure-registries`允许http：</span><br><span class="line"></span><br><span class="line">```json</span><br><span class="line">&#123;</span><br><span class="line">    &quot;registry-mirros&quot;: [&quot;https://xxxx.mirror.aliyuncs.com&quot;],</span><br><span class="line">    &quot;insecure-registries&quot;: [&quot;192.168.xxx.xxx:5000&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ol>
</li>
</ol>
<p>然后重启docker：（新版本的docker会立即生效）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">centos7 的命令</span></span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>



<h3 id="推送到私有仓库"><a href="#推送到私有仓库" class="headerlink" title="推送到私有仓库"></a>推送到私有仓库</h3><p>步骤：</p>
<ol>
<li><p>添加一个对应的私有仓库地址的tag</p>
<ol>
<li><pre><code class="language-bash">docker tag lee/myubuntu:1.0.1 192.168.xxx.xxx:5000/lee/myubuntu:1.0.1
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">2. push到私有仓库</span><br><span class="line"></span><br><span class="line">   1. ```bash</span><br><span class="line">      docker push 192.168.xxx.xxx:5000/lee/myubuntu:1.0.1</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ol>
</li>
<li><p>查看私有仓库总镜像目录验证</p>
<ol>
<li><pre><code class="language-bash">curl http://192.168.xxx.xxx:5000/v2/_catalog
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">拉取验证：</span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line">docker pull 192.169.xxx.xxx:5000/lee/myubuntu:1.0.1</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ol>
</li>
</ol>
<h3 id="阿里云个人镜像私有仓库使用"><a href="#阿里云个人镜像私有仓库使用" class="headerlink" title="阿里云个人镜像私有仓库使用"></a>阿里云个人镜像私有仓库使用</h3><blockquote>
<p>不能使用代理</p>
</blockquote>
<h4 id="登录阿里云Docker-Registry"><a href="#登录阿里云Docker-Registry" class="headerlink" title="登录阿里云Docker Registry"></a>登录阿里云Docker Registry</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker login --username=aliyun4574879579 crpi-cmj7zircwvnevd7y.cn-shenzhen.personal.cr.aliyuncs.com</span><br></pre></td></tr></table></figure>

<h4 id="输入密码"><a href="#输入密码" class="headerlink" title="输入密码"></a>输入密码</h4><h4 id="拉取镜像"><a href="#拉取镜像" class="headerlink" title="拉取镜像"></a>拉取镜像</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull crpi-cmj7zircwvnevd7y.cn-shenzhen.personal.cr.aliyuncs.com/godless/godless_repositories:[镜像版本号]</span><br></pre></td></tr></table></figure>

<h4 id="将镜像打上标签"><a href="#将镜像打上标签" class="headerlink" title="将镜像打上标签"></a>将镜像打上标签</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker tag [ImageId] crpi-cmj7zircwvnevd7y.cn-shenzhen.personal.cr.aliyuncs.com/godless/godless_repositories:[镜像版本号]</span><br></pre></td></tr></table></figure>

<h4 id="将镜像推送到Registry"><a href="#将镜像推送到Registry" class="headerlink" title="将镜像推送到Registry"></a>将镜像推送到Registry</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker push crpi-cmj7zircwvnevd7y.cn-shenzhen.personal.cr.aliyuncs.com/godless/godless_repositories:[镜像版本号]</span><br></pre></td></tr></table></figure>



<h2 id="Docker-安装-Mysql"><a href="#Docker-安装-Mysql" class="headerlink" title="Docker 安装 Mysql"></a>Docker 安装 Mysql</h2><p>以安装 Mysql 5.7为例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull mysql:5.7</span><br></pre></td></tr></table></figure>



<h3 id="Mysql-单机"><a href="#Mysql-单机" class="headerlink" title="Mysql 单机"></a>Mysql 单机</h3><h4 id="简单版-Mysql-5-7-安装"><a href="#简单版-Mysql-5-7-安装" class="headerlink" title="简单版 Mysql 5.7 安装"></a>简单版 Mysql 5.7 安装</h4><p>简单的启动Mysql容器：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">需要使用 -e 配置环境变量 MYSQL_ROOT_PASSWORD（mysql root用户的密码）</span></span><br><span class="line">docker run -p 3306:3306 -e MYSQL_ROOT_PASSWORD=root -d mysql:5.7</span><br></pre></td></tr></table></figure>

<p>简单版的Mysql会存在以下问题：</p>
<ul>
<li><p>中文乱码</p>
</li>
<li><p>没有容器卷映射</p>
</li>
</ul>
<p>启动docker容器后，可以正常的连接、创建数据库，创建表，插入数据。但是插入中文则会报错。</p>
<p>例如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建db01数据库</span></span><br><span class="line"><span class="keyword">create</span> database db01;</span><br><span class="line"><span class="comment">-- 切换到db01;</span></span><br><span class="line">use db01;</span><br><span class="line"><span class="comment">-- 创建表</span></span><br><span class="line"><span class="keyword">create table</span> t1(id <span class="type">int</span>, name <span class="type">varchar</span>(<span class="number">20</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入英文可以正常插入</span></span><br><span class="line"><span class="keyword">insert into</span> t1 <span class="keyword">values</span>(<span class="number">1</span>, <span class="string">&#x27;abc&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入中文报错</span></span><br><span class="line"><span class="keyword">insert into</span> t1 <span class="keyword">values</span>(<span class="number">2</span>, <span class="string">&#x27;张三&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>这是因为docker默认的字符集的问题，可以在mysql中使用以下命令查看数据库字符集：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;character%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>返回的字符集中，<code>character_set_database</code>、<code>character_set_server</code>等都为<code>latin1</code>字符集，所以会报错。</p>
<p>而且因为启动容器时没有配置容器卷映射，当容器意外被删时，数据无法找回。</p>
<h3 id="实际应用版-Mysql-5-7安装"><a href="#实际应用版-Mysql-5-7安装" class="headerlink" title="实际应用版 Mysql 5.7安装"></a>实际应用版 Mysql 5.7安装</h3><p>启动 Mysql 容器，并配置容器卷映射：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 3306:3306 \</span><br><span class="line">           --privileged=true \</span><br><span class="line">           -v /app/mysql/log:/var/log/mysql \</span><br><span class="line">           -v /app/mysql/data:/var/lib/mysql \</span><br><span class="line">           -v /app/mysql/conf:/etc/mysql/conf.d \</span><br><span class="line">           -e MYSQL_ROOT_PASSWORD=root \</span><br><span class="line">           --name mysql \</span><br><span class="line">           mysql:5.7</span><br></pre></td></tr></table></figure>

<p>在<code>/app/mysql/conf</code>下新建 <code>my.cnf</code>，通过容器卷同步给mysql实例，解决中文乱码问题：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[client]</span></span><br><span class="line"><span class="attr">default-character-set</span>=utf8</span><br><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="attr">collation_server</span> = utf8_general_ci</span><br><span class="line"><span class="attr">character_set_server</span> = utf8 </span><br></pre></td></tr></table></figure>

<p>重启mysql容器，使得容器重新加载配置文件：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart mysql</span><br></pre></td></tr></table></figure>

<p>此时便解决了中文乱码（中文插入报错）问题。</p>
<p>而且因为启动时将容器做了容器卷映射，将mysql的配置（映射到<code>/app/mysql/conf</code>）、数据（映射到<code>/app/mysql/data</code>）、日志（映射到<code>/app/mysql/log</code>）都映射到了宿主机实际目录，所以即使删除了容器，也不会产生太大影响。只需要再执行一下启动Mysql容器命令，容器卷还按相同位置进行映射，所有的数据便都可以正常恢复。</p>
<h3 id="Mysql主从复制安装"><a href="#Mysql主从复制安装" class="headerlink" title="Mysql主从复制安装"></a>Mysql主从复制安装</h3><h4 id="安装主服务器容器实例（端口号3307）："><a href="#安装主服务器容器实例（端口号3307）：" class="headerlink" title="安装主服务器容器实例（端口号3307）："></a>安装主服务器容器实例（端口号3307）：</h4><ol>
<li><p>启动容器实例</p>
<ol>
<li><pre><code class="language-bash">docker run -p 3307:3306 \
           --name mysql-master \
           --privileged=true \
           -v /app/mysql-master/log:/var/log/mysql \
           -v /app/mysql-master/data:/var/lib/mysql \
           -v /app/mysql-master/conf:/etc/mysql \
           -e MYSQL_ROOT_PASSWORD=123456 \
           -d mysql:5.7
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">2. 进入`/app/mysql-master/conf`，新建`my.cnf`配置文件：</span><br><span class="line"></span><br><span class="line">   1. ```ini</span><br><span class="line">      [mysqld]</span><br><span class="line">      ## 设置server_id, 同一个局域网中需要唯一</span><br><span class="line">      server_id=101</span><br><span class="line">      ## 指定不需要同步的数据库名称</span><br><span class="line">      binlog-ignore-db=mysql</span><br><span class="line">      ## 开启二进制日志功能</span><br><span class="line">      log-bin=mall-mysql-bin</span><br><span class="line">      ## 设置二进制日志使用内存大小（事务）</span><br><span class="line">      binlog_cache_size=1M</span><br><span class="line">      ## 设置使用的二进制日志格式（mixed,statement,row）</span><br><span class="line">      binlog_format=mixed</span><br><span class="line">      ## 二进制日志过期清理时间。默认值为0，表示不自动清理</span><br><span class="line">      expire_logs_days=7</span><br><span class="line">      ## 跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断</span><br><span class="line">      ## 如：1062错误是指一些主键重复，1032错误是因为主从数据库数据不一致</span><br><span class="line">      slave_skip_errors=1062</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ol>
</li>
<li><p>重启容器实例</p>
<ol>
<li><pre><code class="language-bash">docker restart mysql-master
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">4. 进入容器实例内</span><br><span class="line"></span><br><span class="line">   1. ```bash&#x27;</span><br><span class="line">      docker exec -it mysql-master /bin/bash</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ol>
</li>
</ol>
<h4 id="安装从服务器容器实例（端口号3308）："><a href="#安装从服务器容器实例（端口号3308）：" class="headerlink" title="安装从服务器容器实例（端口号3308）："></a>安装从服务器容器实例（端口号3308）：</h4><blockquote>
<p>别人笔记有个问题：<a target="_blank" rel="noopener" href="https://www.yuque.com/tmfl/cloud/nr5kfx">https://www.yuque.com/tmfl/cloud/nr5kfx</a></p>
<p><strong>配置文件挂载路径错误（致命问题）</strong></p>
<ul>
<li><p><strong>错误表现</strong>：<br> 将宿主机的 <code>/app/mysql-slave/conf</code> 目录挂载到容器的 <code>/etc/mysql</code>，这会 <strong>覆盖容器内 MySQL 的默认配置目录</strong>，导致 MySQL 服务无法启动。</p>
</li>
<li><p><strong>原因分析</strong>：<br> MySQL 镜像的默认配置文件路径为 <code>/etc/mysql/my.cnf</code>，而挂载空目录到 <code>/etc/mysql</code> 会导致容器内原有的配置文件被清空。</p>
</li>
<li><p><strong>修复方案</strong>：<br> 改为挂载到子目录 <code>/etc/mysql/conf.d</code>（专门存放自定义配置）：</p>
</li>
<li><pre><code class="language-bash">-v /app/mysql-slave/conf:/etc/mysql/conf.d  # 注意路径修正
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">1. 启动容器实例</span><br><span class="line"></span><br><span class="line">  1. ```bash</span><br><span class="line">     docker run -p 3308:3306 \</span><br><span class="line">                --name mysql-slave \</span><br><span class="line">                --privileged=true \</span><br><span class="line">                -v /app/mysql-slave/log:/var/log/mysql \</span><br><span class="line">                -v /app/mysql-slave/data:/var/lib/mysql \</span><br><span class="line">                -v /app/mysql-slave/conf:/etc/mysql/conf.d \</span><br><span class="line">                -e MYSQL_ROOT_PASSWORD=123456 \</span><br><span class="line">                -d mysql:5.7</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
</blockquote>
<ol start="2">
<li><p>进入<code>/app/mysql-slave/conf</code>目录，创建<code>my.cnf</code>配置文件：</p>
<ol>
<li><pre><code class="language-ini">[mysqld]
## 设置server_id, 同一个局域网内需要唯一
server_id=102
## 指定不需要同步的数据库名称
binlog-ignore-db=mysql
## 开启二进制日志功能，以备slave作为其它数据库实例的Master时使用
log-bin=mall-mysql-slave1-bin
## 设置二进制日志使用内存大小（事务）
binlog_cache_size=1M
## 设置使用的二进制日志格式（mixed,statement,row）
binlog_format=mixed
## 二进制日志过期清理时间。默认值为0，表示不自动清理
expire_logs_days=7
## 跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断
## 如：1062错误是指一些主键重复，1032是因为主从数据库数据不一致
slave_skip_errors=1062
## relay_log配置中继日志
relay_log=mall-mysql-relay-bin
## log_slave_updates表示slave将复制事件写进自己的二进制日志
log_slave_updates=1
## slave设置只读（具有super权限的用户除外）
read_only=1
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">3. 修改完配置需要重启slave容器实例</span><br><span class="line"></span><br><span class="line">   1. ```bash</span><br><span class="line">      docker restart mysql-slave</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ol>
</li>
</ol>
<h3 id="开始设置同步"><a href="#开始设置同步" class="headerlink" title="开始设置同步"></a>开始设置同步</h3><h4 id="配置主数据库"><a href="#配置主数据库" class="headerlink" title="配置主数据库"></a>配置主数据库</h4><ol>
<li><p>进入<strong>主数据库</strong>容器（mysql-master)查看同步状态（同步需要设置的参数）：</p>
<ol>
<li><pre><code class="language-bash">docker exec -it mysql-master /bin/bash
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">2. 进入Mysql</span><br><span class="line"></span><br><span class="line">   1. ```bash</span><br><span class="line">      mysql -uroot -p</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ol>
</li>
<li><p>查看主从同步状态</p>
<ol>
<li><pre><code class="language-bash">show master status;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">4. 主要查看返回结果的文件名`File`、当前位置`Position` </span><br><span class="line"></span><br><span class="line">   1. 主要查看返回结果的文件名`File`、当前位置`Position` </span><br><span class="line">   2. 这个到时候到给从数据库设置，要设置一样的</span><br><span class="line"></span><br><span class="line">5. 创建同步用户用来同步数据库</span><br><span class="line"></span><br><span class="line">   1. ```mysql</span><br><span class="line">      -- 创建数据同步用户</span><br><span class="line">      create user &#x27;godless&#x27;@&#x27;%&#x27; identified by &#x27;123456&#x27;;</span><br><span class="line">      -- 授权</span><br><span class="line">      grant replication slave, replication client on *.* to &#x27;godless&#x27;@&#x27;%&#x27;;</span><br><span class="line">      flush privileges;</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ol>
</li>
</ol>
<h4 id="进入从数据库容器，配置主从复制："><a href="#进入从数据库容器，配置主从复制：" class="headerlink" title="进入从数据库容器，配置主从复制："></a>进入<strong>从数据库</strong>容器，配置主从复制：</h4><ol>
<li><p>进入<strong>从数据库</strong>容器（mysql-slave)</p>
<ol>
<li><pre><code class="language-bash">docker exec -it mysql-slave /bin/bash
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">2. 进入数据库</span><br><span class="line"></span><br><span class="line">   1. ```bash</span><br><span class="line">      mysql -uroot -p</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ol>
</li>
<li><p>配置从数据库所属的主数据库： </p>
<ol>
<li><pre><code class="language-mysql">-- 格式：
-- change master to master_host=&#39;宿主机ip&#39;,master_user=&#39;主数据库配置的主从复制用户名&#39;,master_password=&#39;主数据库配置的主从复制用户密码&#39;,master_port=宿主机主数据库端口,master_log_file=&#39;主数据库主从同步状态的文件名File&#39;,master_log_pos=主数据库主从同步状态的Position,master_connect_retry=连接失败重试时间间隔（秒）;

change master to master_host=&#39;192.168.xxx.xxx&#39;,master_user=&#39;slave&#39;,master_password=&#39;123456&#39;,master_port=3307,master_log_file=&#39;mall-mysql-bin.000001&#39;,master_log_pos=769,master_connect_retry=30;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">   2. &gt;master_host：主数据库的IP地址；</span><br><span class="line">      &gt;master_port：主数据库的运行端口；</span><br><span class="line">      &gt;master_user：在主数据库创建的用于同步数据的用户账号；</span><br><span class="line">      &gt;master_password：在主数据库创建的用于同步数据的用户密码；</span><br><span class="line">      &gt;master_log_file：指定从数据库要复制数据的日志文件，通过查看主数据的状态，获取File参数；</span><br><span class="line">      &gt;master_log_pos：指定从数据库从哪个位置开始复制数据，通过查看主数据的状态，获取Position参数；</span><br><span class="line">      &gt;master_connect_retry：连接失败重试的时间间隔，单位为秒。</span><br><span class="line"></span><br><span class="line">   3. 这里等master_host请查看自己宿主机的ip地址，也就是说在虚拟机里面命令行输入`ifconfig`结果里面的`inet`也就是192.168.xxx.xxx</span><br><span class="line"></span><br><span class="line">4. 查看主从同步状态： </span><br><span class="line"></span><br><span class="line">   1. ```bash</span><br><span class="line">      start slave;</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ol>
</li>
<li><p>再次查看主从同步状态，<code>Slave_IO_Running</code>、<code>Slave_SQL_Running</code>都变为<code>Yes</code>。</p>
</li>
</ol>
<blockquote>
<p>配置失败后想重新配置从数据库所属的主数据库</p>
<p>会报错是slave还在运行，也就是从数据库想去连接主数据库一直连接失败，所以一直在重复尝试，你不可以修改配置</p>
<p>你要先停掉slave重新配置才行</p>
<p><strong>停止 Slave 的 IO 线程</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">STOP SLAVE IO_THREAD;</span><br></pre></td></tr></table></figure>

<p>或者直接停止所有 Slave 线程：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">STOP SLAVE;</span><br></pre></td></tr></table></figure></blockquote>
<h3 id="主从复制测试："><a href="#主从复制测试：" class="headerlink" title="主从复制测试："></a>主从复制测试：</h3><ol>
<li><p>在主数据库上新建库、使用库、新建表、插入数据</p>
<ol>
<li><pre><code class="language-mysql">create database db01;
use db01;
create table t1 (id int, name varchar(20));
insert into t1 values (1, &#39;abc&#39;);
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">2. 在从数据库上使用库、查看记录</span><br><span class="line"></span><br><span class="line">   1. ```mysql</span><br><span class="line">      show databases;</span><br><span class="line">      use db01;</span><br><span class="line">      select * from t1;</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ol>
</li>
</ol>
<h2 id="Docker安装Redis"><a href="#Docker安装Redis" class="headerlink" title="Docker安装Redis"></a>Docker安装Redis</h2><h3 id="拉取Redis6-0-8"><a href="#拉取Redis6-0-8" class="headerlink" title="拉取Redis6.0.8"></a>拉取Redis6.0.8</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull redis:6.0.8</span><br></pre></td></tr></table></figure>

<h3 id="单机版安装"><a href="#单机版安装" class="headerlink" title="单机版安装"></a>单机版安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 6379:6379 -d redis:6.0.8</span><br></pre></td></tr></table></figure>

<h3 id="实际应用版"><a href="#实际应用版" class="headerlink" title="实际应用版"></a>实际应用版</h3><p>步骤：</p>
<ol>
<li><p>宿主机创建目录<code>/app/redis</code> </p>
</li>
<li><p>在<code>/app/redis</code>下创建文件<code>redis.conf</code>，主要修改以下几项配置 </p>
</li>
<li><pre><code class="language-ini"># 开启密码验证（可选）
requirepass 123

# 允许redis外地连接，需要注释掉绑定的IP
# bind 127.0.0.1

# 关闭保护模式（可选）
protected-mode no

# 注释掉daemonize yes，或者配置成 daemonize no。因为该配置和 docker run中的 -d 参数冲突，会导致容器一直启动失败
daemonize no

# 开启redis数据持久化， （可选）
appendonly yes
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">3. 运行容器</span><br><span class="line"></span><br><span class="line">   1. 启动docker容器：（因为要使用自定义的配置文件，所以需要指定容器运行的命令为`redis-server 容器内配置文件路径`） </span><br><span class="line"></span><br><span class="line">   2. ```bash</span><br><span class="line">      docker run -d -p 6379:6379 --name redis --privileged=true \</span><br><span class="line">                 -v /app/redis/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">                 -v /app/redis/data:/data \</span><br><span class="line">                 redis:6.0.8 \</span><br><span class="line">                 redis-server /etc/redis/redis.conf</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ol>
<h2 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h2><p>Dockerfile是用来构建Docker镜像的文本文件，是由一条条构建镜像所需的指令和参数构成的脚本。</p>
<p>构建步骤：</p>
<ol>
<li>编写Dockerfile文件</li>
<li><code>docker build</code>命令构建镜像</li>
<li><code>docker run</code>依据镜像运行容器实例</li>
</ol>
<h3 id="构建过程"><a href="#构建过程" class="headerlink" title="构建过程"></a>构建过程</h3><p>Dockerfile编写：</p>
<ul>
<li><p>每条保留字指令都必须为大写字母，且后面要跟随至少一个参数</p>
</li>
<li><p>指令按照从上到下顺序执行</p>
</li>
<li><p><code>#</code>表示注释</p>
</li>
<li><p>每条指令都会创建一个新的镜像层并对镜像进行提交</p>
</li>
</ul>
<p>Docker引擎执行Docker的大致流程：</p>
<ol>
<li>docker从基础镜像运行一个容器</li>
<li>执行一条指令并对容器做出修改</li>
<li>执行类似<code>docker commit</code>的操作提交一个新的镜像层</li>
<li>docker再基于刚提交的镜像运行一个新容器</li>
<li>执行Dockerfile中的下一条指令，直到所有指令都执行完成</li>
</ol>
<h3 id="Dockerfile保留字"><a href="#Dockerfile保留字" class="headerlink" title="Dockerfile保留字"></a>Dockerfile保留字</h3><h4 id="FROM"><a href="#FROM" class="headerlink" title="FROM"></a>FROM</h4><p>基础镜像，当前新镜像是基于哪个镜像，指定一个已经存在的镜像作为模版。Dockerfile第一条必须是FROM</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># FROM 镜像名</span></span><br><span class="line"><span class="keyword">FROM</span> hub.c.<span class="number">163</span>.com/library/tomcat</span><br></pre></td></tr></table></figure>



<h4 id="MAINTAINER"><a href="#MAINTAINER" class="headerlink" title="MAINTAINER"></a>MAINTAINER</h4><p>镜像维护者的姓名和邮箱地址</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 非必须</span></span><br><span class="line"><span class="keyword">MAINTAINER</span> ZhangSan zs@<span class="number">163</span>.com</span><br></pre></td></tr></table></figure>



<h4 id="RUN"><a href="#RUN" class="headerlink" title="RUN"></a>RUN</h4><p>容器构建时需要运行的命令。</p>
<p>有两种格式：</p>
<p>shell格式</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 等同于在终端操作的shell命令</span></span><br><span class="line"><span class="comment"># 格式：RUN &lt;命令行命令&gt;</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> yum -y install vim</span></span><br></pre></td></tr></table></figure>

<p>exec格式</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 格式：RUN [&quot;可执行文件&quot; , &quot;参数1&quot;, &quot;参数2&quot;]</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> [<span class="string">&quot;./test.php&quot;</span>, <span class="string">&quot;dev&quot;</span>, <span class="string">&quot;offline&quot;</span>]  <span class="comment"># 等价于 RUN ./test.php dev offline</span></span></span><br></pre></td></tr></table></figure>

<p><code>RUN</code>是在<code>docker build</code>时运行</p>
<h4 id="EXPOSE"><a href="#EXPOSE" class="headerlink" title="EXPOSE"></a>EXPOSE</h4><p>当前容器对外暴露出的端口</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># EXPOSE 要暴露的端口</span></span><br><span class="line"><span class="comment"># EXPOSE &lt;port&gt;[/&lt;protocol] ....</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">3306</span> <span class="number">33060</span></span><br></pre></td></tr></table></figure>



<h4 id="WORKDIR"><a href="#WORKDIR" class="headerlink" title="WORKDIR"></a>WORKDIR</h4><p>指定在创建容器后， 终端默认登录进来的工作目录。</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENV</span> CATALINA_HOME /usr/local/tomcat</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> <span class="variable">$CATALINA_HOME</span></span></span><br></pre></td></tr></table></figure>



<h4 id="USER"><a href="#USER" class="headerlink" title="USER"></a>USER</h4><p>指定该镜像以什么样的用户去执行，如果不指定，默认是<code>root</code>。（一般不修改该配置）</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># USER &lt;user&gt;[:&lt;group&gt;]</span></span><br><span class="line"><span class="keyword">USER</span> patrick</span><br></pre></td></tr></table></figure>



<h4 id="ENV"><a href="#ENV" class="headerlink" title="ENV"></a>ENV</h4><p>用来在构建镜像过程中设置环境变量。</p>
<p>这个环境变量可以在后续的任何<code>RUN</code>指令或其他指令中使用</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 格式 ENV 环境变量名 环境变量值</span></span><br><span class="line"><span class="comment"># 或者 ENV 环境变量名=值</span></span><br><span class="line"><span class="keyword">ENV</span> MY_PATH /usr/mytest</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用环境变量</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> <span class="variable">$MY_PATH</span></span></span><br></pre></td></tr></table></figure>



<h4 id="VOLUME"><a href="#VOLUME" class="headerlink" title="VOLUME"></a>VOLUME</h4><p>容器数据卷，用于数据保存和持久化工作。类似于 <code>docker run</code> 的<code>-v</code>参数。</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># VOLUME 挂载点</span></span><br><span class="line"><span class="comment"># 挂载点可以是一个路径，也可以是数组（数组中的每一项必须用双引号）</span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="language-bash"> /var/lib/mysql</span></span><br></pre></td></tr></table></figure>



<h4 id="ADD"><a href="#ADD" class="headerlink" title="ADD"></a>ADD</h4><p>将宿主机目录下（或远程文件）的文件拷贝进镜像，且会自动处理URL和解压tar压缩包。</p>
<h4 id="COPY"><a href="#COPY" class="headerlink" title="COPY"></a>COPY</h4><p>类似<code>ADD</code>，拷贝文件和目录到镜像中。</p>
<p>将从构建上下文目录中<code>&lt;源路径&gt;</code>的文件目录复制到新的一层镜像内的<code>&lt;目标路径&gt;</code>位置。</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">COPY</span><span class="language-bash"> src dest</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> [<span class="string">&quot;src&quot;</span>, <span class="string">&quot;dest&quot;</span>]</span></span><br><span class="line"><span class="comment"># &lt;src源路径&gt;：源文件或者源目录</span></span><br><span class="line"><span class="comment"># &lt;dest目标路径&gt;：容器内的指定路径，该路径不用事先建好。如果不存在会自动创建</span></span><br></pre></td></tr></table></figure>



<h4 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h4><p>指定容器启动后要干的事情。</p>
<p>有两种格式：</p>
<p>shell格式</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">CMD &lt;命令&gt;</span></span><br><span class="line">CMD echo &quot;hello world&quot;</span><br></pre></td></tr></table></figure>

<p>exec格式</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CMD [&quot;可执行文件&quot;, &quot;参数1&quot;, &quot;参数2&quot; ...]</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;catalina.sh&quot;</span>, <span class="string">&quot;run&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<p>参数列表格式</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CMD [&quot;参数1&quot;, &quot;参数2&quot; ....]，与ENTRYPOINT指令配合使用</span></span><br></pre></td></tr></table></figure>

<p>Dockerfile中如果出现多个<code>CMD</code>指令，只有最后一个生效。<code>CMD</code>会被<code>docker run</code>之后的参数替换。</p>
<p>例如，对于tomcat镜像，执行以下命令会有不同的效果：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">因为tomcat的Dockerfile中指定了 CMD [<span class="string">&quot;catalina.sh&quot;</span>, <span class="string">&quot;run&quot;</span>]</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">所以直接docker run 时，容器启动后会自动执行 catalina.sh run</span></span><br><span class="line">docker run -it -p 8080:8080 tomcat</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">指定容器启动后执行 /bin/bash</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">此时指定的/bin/bash会覆盖掉Dockerfile中指定的 CMD [<span class="string">&quot;catalina.sh&quot;</span>, <span class="string">&quot;run&quot;</span>]</span></span><br><span class="line">docker run -it -p 8080:8080 tomcat /bin/bash</span><br></pre></td></tr></table></figure>

<p><code>CMD</code>是在<code>docker run</code>时运行，而 <code>RUN</code>是在<code>docker build</code>时运行。</p>
<h4 id="ENTRYPOINT"><a href="#ENTRYPOINT" class="headerlink" title="ENTRYPOINT"></a>ENTRYPOINT</h4><p>用来指定一个容器启动时要运行的命令。</p>
<p>类似于<code>CMD</code>命令，但是<code>ENTRYPOINT</code>不会被<code>docker run</code>后面的命令覆盖，这些命令参数会被当做参数送给<code>ENTRYPOINT</code>指令指定的程序。</p>
<p><code>ENTRYPOINT</code>可以和<code>CMD</code>一起用，一般是可变参数才会使用<code>CMD</code>，这里的<code>CMD</code>等于是在给<code>ENTRYPOINT</code>传参。</p>
<p>当指定了<code>ENTRYPOINT</code>后，<code>CMD</code>的含义就发生了变化，不再是直接运行期命令，而是将<code>CMD</code>的内容作为参数传递给<code>ENTRYPOINT</code>指令，它们两个组合会变成 <code>&lt;ENTRYPOINT&gt; &quot;&lt;CMD&gt;&quot;</code>。</p>
<p>例如：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> nginx</span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;nginx&quot;</span>, <span class="string">&quot;-c&quot;</span>]  <span class="comment"># 定参</span></span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;/etc/nginx/nginx.conf&quot;</span>] <span class="comment"># 变参</span></span></span><br></pre></td></tr></table></figure>

<p>对于此Dockerfile，构建成镜像 <code>nginx:test</code>后，如果执行；</p>
<ul>
<li><p><code>docker run nginx test</code>，则容器启动后，会执行 <code>nginx -c /etc/nginx/nginx.conf</code></p>
</li>
<li><p><code>docker run nginx:test /app/nginx/new.conf</code>，则容器启动后，会执行 <code>nginx -c /app/nginx/new.conf</code></p>
</li>
</ul>
<h3 id="构建镜像"><a href="#构建镜像" class="headerlink" title="构建镜像"></a>构建镜像</h3><p>创建名称为<code>Dockerfile</code>的文件，示例：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu</span><br><span class="line"><span class="keyword">MAINTAINER</span> godless&lt;godless@xxx.com&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> MYPATH /usr/local</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> <span class="variable">$MYPATH</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install net-tools</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> <span class="built_in">echo</span> <span class="variable">$MYPATH</span></span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&quot;install ifconfig cmd into ubuntu success .....&quot;</span></span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> /bin/bash</span></span><br></pre></td></tr></table></figure>

<p>编写完成之后，将其构建成docker镜像。</p>
<p>命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 注意：定义的TAG后面有个空格，空格后面有个点</span></span><br><span class="line"><span class="comment"># docker build -t 新镜像名字:TAG .</span></span><br><span class="line">docker build -t ubuntu:1.0.1 .</span><br></pre></td></tr></table></figure>



<h3 id="虚悬镜像-1"><a href="#虚悬镜像-1" class="headerlink" title="虚悬镜像"></a>虚悬镜像</h3><p>虚悬镜像：仓库名、标签名都是 <code>&lt;none&gt;</code>的镜像，称为 dangling images（虚悬镜像）。</p>
<p>在构建或者删除镜像时可能由于一些错误导致出现虚悬镜像。</p>
<p>例如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 构建时候没有镜像名、tag</span></span><br><span class="line">docker build .</span><br></pre></td></tr></table></figure>

<p>列出docker的虚悬镜像：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image <span class="built_in">ls</span> -f dangling=<span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>虚悬镜像一般是因为一些错误而出现的，没有存在价值，可以删除：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除所有的虚悬镜像</span></span><br><span class="line">docker image prune</span><br></pre></td></tr></table></figure>



<h2 id="Docker-Desktop-For-Windows-安装"><a href="#Docker-Desktop-For-Windows-安装" class="headerlink" title="Docker Desktop For Windows 安装"></a>Docker Desktop For Windows 安装</h2><blockquote>
<p>注意：以下要用<code>PowerShell</code>管理员身份运行 </p>
</blockquote>
<h3 id="安装wsl2"><a href="#安装wsl2" class="headerlink" title="安装wsl2"></a>安装wsl2</h3><blockquote>
<p>我的建议是跟着<a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/windows/wsl/install-manual%E6%AD%A5%E9%AA%A4%E5%81%9A%E4%B8%80%E9%81%8D%E5%92%8C%E8%BF%99%E4%B8%AA%E5%B7%AE%E4%B8%8D%E5%A4%9A%EF%BC%8C%E7%9C%8B%E6%96%87%E6%A1%A3%E6%AF%94%E8%BE%83%E6%89%8E%E5%AE%9E%E7%82%B9">https://learn.microsoft.com/en-us/windows/wsl/install-manual步骤做一遍和这个差不多，看文档比较扎实点</a></p>
</blockquote>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dism.exe /online /<span class="built_in">enable-feature</span> /featurename:Microsoft<span class="literal">-Windows-Subsystem-Linux</span> /all /norestart</span><br></pre></td></tr></table></figure>

<h3 id="启用虚拟机平台功能"><a href="#启用虚拟机平台功能" class="headerlink" title="启用虚拟机平台功能"></a>启用虚拟机平台功能</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dism.exe /online /<span class="built_in">enable-feature</span> /featurename:VirtualMachinePlatform /all /norestart</span><br></pre></td></tr></table></figure>

<h3 id="将-WSL-默认版本设置为-WSL2"><a href="#将-WSL-默认版本设置为-WSL2" class="headerlink" title="将 WSL 默认版本设置为 WSL2"></a>将 WSL 默认版本设置为 WSL2</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl <span class="literal">--set-default-version</span> <span class="number">2</span></span><br></pre></td></tr></table></figure>

<h3 id="重启"><a href="#重启" class="headerlink" title="重启"></a>重启</h3><h3 id="安装Ubuntu"><a href="#安装Ubuntu" class="headerlink" title="安装Ubuntu"></a>安装Ubuntu</h3><p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/windows/wsl/install-manual">https://learn.microsoft.com/en-us/windows/wsl/install-manual</a></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> Ubuntu_x64</span><br><span class="line">wsl <span class="literal">--import</span> Ubuntu<span class="literal">-24</span>.<span class="number">04</span> D:\<span class="number">01</span>EnvApp\WSL\Ubuntu<span class="literal">-24</span>.<span class="number">04</span>\ D:\<span class="number">01</span>EnvApp\WSL`\Ubuntu<span class="literal">-24</span>.<span class="number">04</span>\Extracted\Ubuntu_x64\install.tar.gz <span class="literal">--version</span> <span class="number">2</span></span><br></pre></td></tr></table></figure>





<h2 id="docker数据迁移"><a href="#docker数据迁移" class="headerlink" title="docker数据迁移"></a>docker数据迁移</h2><ol>
<li>新建容器</li>
<li>导出数据库<ol>
<li>用’mysqldump’ 导出</li>
</ol>
</li>
<li>导入数据库<ol>
<li>宿主机进入命令行</li>
<li>查看正在运行的容器<ol>
<li><code>docker ps</code></li>
<li>查看数据库id</li>
</ol>
</li>
<li>登入容器并导入数据库资料</li>
</ol>
</li>
</ol>
<p>登入容器并导入数据库资料命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -i 容器<span class="built_in">id</span> sh -c <span class="string">&#x27;exec mysql -uroot -p123456&#x27;</span> &lt; C:\Users\Godless\Desktop\all_database.sql</span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.godless.site/i/1/2025/05/23/682f5025e5b4a.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.godless.site/i/1/2025/05/23/682f5025e5b4a.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">Godless</div><div class="post-copyright__author_desc"></div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://example.com/2025/04/22/%E6%8A%80%E6%9C%AF/%E8%BF%90%E8%90%A5/docker%E7%AC%94%E8%AE%B0/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://example.com/2025/04/22/技术/运营/docker笔记/')">docker笔记</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://example.com/2025/04/22/%E6%8A%80%E6%9C%AF/%E8%BF%90%E8%90%A5/docker%E7%AC%94%E8%AE%B0/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=docker笔记&amp;url=http://example.com/2025/04/22/%E6%8A%80%E6%9C%AF/%E8%BF%90%E8%90%A5/docker%E7%AC%94%E8%AE%B0/&amp;pic=https://image.godless.site/i/1/2025/05/23/682f5159c1e1f.jpg?_r_=a1d7ea70-65c0-d5d4-27fd-89b4941b3df6" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">Godless</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/docker/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>docker<span class="tagsPageCount">1</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://image.godless.site/i/1/2025/05/23/682f5159c1e1f.jpg?_r_=9642d51d-1bea-c10e-8ae1-394f9b309b38" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/04/22/%E6%8A%80%E6%9C%AF/%E5%85%A8%E6%A0%88/%E8%8B%A5%E4%BE%9D%E5%AE%9E%E7%8E%B0%E9%80%9A%E7%94%A8%E6%9F%A5%E8%AF%A2-sql%E5%8A%A8%E6%80%81%E6%9F%A5%E8%AF%A2/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.godless.site/i/1/2025/05/23/682f5159c1e1f.jpg?_r_=b9f71eeb-12a6-fdda-0586-60377866bf8f" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">若依实现通用查询-sql动态查询</div></div></a></div><div class="next-post pull-right"><a href="/2025/04/23/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF/Vue%E7%A6%81%E7%94%A8%E8%BF%9E%E7%BB%AD%E5%A4%9A%E6%AC%A1%E7%82%B9%E5%87%BB/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.godless.site/i/1/2025/05/23/682f5159c1e1f.jpg?_r_=12092526-f357-f783-2814-5351e31cf39e" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Vue-Element禁用连续多次点击</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.godless.site/i/1/2025/05/23/682f5025e5b4a.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://twikoo-magic.oss-cn-hangzhou.aliyuncs.com/bilibilitv/[tv_色].png" alt="status"/></div></div><div class="author-info__description">努力和自己和解</div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/about"><h1 class="author-info__name">Godless</h1><div class="author-info__desc"></div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/Godless-linzecan" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/660669789" target="_blank" title="BiliBili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://bu.dusays.com/2023/05/13/645fa415e8694.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0"><span class="toc-number">1.</span> <span class="toc-text">Docker学习笔记</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%90%86%E5%BF%B5%E7%AE%80%E4%BB%8B"><span class="toc-number">1.1.</span> <span class="toc-text">理念简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E4%B8%8E%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%9A%84%E6%AF%94%E8%BE%83"><span class="toc-number">1.2.</span> <span class="toc-text">容器与虚拟机的比较</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%A0%E7%BB%9F%E8%99%9A%E6%8B%9F%E6%9C%BA"><span class="toc-number">1.2.1.</span> <span class="toc-text">传统虚拟机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Linux%E5%AE%B9%E5%99%A8"><span class="toc-number">1.2.2.</span> <span class="toc-text">Linux容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AF%94%E8%BE%83"><span class="toc-number">1.2.3.</span> <span class="toc-text">比较</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DevOps"><span class="toc-number">1.3.</span> <span class="toc-text">DevOps</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%95%9C%E5%83%8F%E4%B8%8B%E8%BD%BD"><span class="toc-number">1.4.</span> <span class="toc-text">镜像下载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%BB%84%E6%88%90"><span class="toc-number">1.5.</span> <span class="toc-text">docker的基本组成</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E8%AE%BA%E6%80%BB%E7%BB%93"><span class="toc-number">1.5.1.</span> <span class="toc-text">概论总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE"><span class="toc-number">1.6.</span> <span class="toc-text">Docker安装和配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%B8%E8%BD%BD%E6%97%A7%E7%89%88%E6%9C%AC"><span class="toc-number">1.6.1.</span> <span class="toc-text">卸载旧版本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E9%98%BF%E9%87%8C%E4%BA%91%E9%95%9C%E5%83%8F%E6%BA%90"><span class="toc-number">1.6.2.</span> <span class="toc-text">配置阿里云镜像源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85gcc%E5%92%8Cgcc-c"><span class="toc-number">1.6.3.</span> <span class="toc-text">安装gcc和gcc-c++</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%BA%93%EF%BC%88%E6%9A%82%E6%97%B6%E6%B2%A1%E6%90%9E%E6%B8%85%E6%A5%9A%EF%BC%89"><span class="toc-number">1.6.4.</span> <span class="toc-text">存储库（暂时没搞清楚）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEyum%E8%B5%84%E6%BA%90%E5%BA%93"><span class="toc-number">1.6.5.</span> <span class="toc-text">配置yum资源库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85Docker%E5%BC%95%E6%93%8E"><span class="toc-number">1.6.6.</span> <span class="toc-text">安装Docker引擎</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8docker%E5%BC%95%E6%93%8E"><span class="toc-number">1.6.7.</span> <span class="toc-text">启动docker引擎</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%90%E8%A1%8CHelloWorld%E6%B5%8B%E8%AF%95"><span class="toc-number">1.6.8.</span> <span class="toc-text">运行HelloWorld测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%B8%E8%BD%BDdocker"><span class="toc-number">1.6.9.</span> <span class="toc-text">卸载docker</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%BF%E9%87%8C%E4%BA%91%E9%95%9C%E5%83%8F%E5%8A%A0%E9%80%9F"><span class="toc-number">1.6.10.</span> <span class="toc-text">阿里云镜像加速</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%B7%E6%96%B0%E9%85%8D%E7%BD%AE"><span class="toc-number">1.6.11.</span> <span class="toc-text">刷新配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%88%90%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.6.12.</span> <span class="toc-text">配置成系统服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%88%90%E8%87%AA%E5%90%AF%E5%8A%A8"><span class="toc-number">1.6.13.</span> <span class="toc-text">配置成自启动</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker%E4%B8%8B%E8%BD%BD%E5%8A%A0%E9%80%9F"><span class="toc-number">1.7.</span> <span class="toc-text">Docker下载加速</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">1.8.</span> <span class="toc-text">常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E7%B1%BB%E5%91%BD%E4%BB%A4"><span class="toc-number">1.8.1.</span> <span class="toc-text">启动类命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%AE%E5%8A%A9%E7%B1%BB%E5%91%BD%E4%BB%A4"><span class="toc-number">1.8.2.</span> <span class="toc-text">帮助类命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%95%9C%E5%83%8F%E5%91%BD%E4%BB%A4"><span class="toc-number">1.8.3.</span> <span class="toc-text">镜像命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93%E4%B8%AD%E6%90%9C%E7%B4%A2%E9%95%9C%E5%83%8F"><span class="toc-number">1.8.4.</span> <span class="toc-text">在远程仓库中搜索镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BD%E9%95%9C%E5%83%8F"><span class="toc-number">1.8.5.</span> <span class="toc-text">下载镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%8D%A0%E6%8D%AE%E7%A9%BA%E9%97%B4"><span class="toc-number">1.8.6.</span> <span class="toc-text">查看占据空间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E9%95%9C%E5%83%8F"><span class="toc-number">1.8.7.</span> <span class="toc-text">删除镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%99%9A%E6%82%AC%E9%95%9C%E5%83%8F"><span class="toc-number">1.8.8.</span> <span class="toc-text">虚悬镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E8%87%AA%E5%8A%A8%E8%A1%A5%E5%85%A8"><span class="toc-number">1.8.9.</span> <span class="toc-text">命令自动补全</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker%E5%90%8E%E5%8F%B0%E8%BF%90%E8%A1%8C%E4%B8%80%E4%B8%AA%E4%B8%80%E7%9B%B4%E8%BF%90%E8%A1%8C%E7%9A%84%E5%AE%B9%E5%99%A8"><span class="toc-number">1.8.10.</span> <span class="toc-text">Docker后台运行一个一直运行的容器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">1.9.</span> <span class="toc-text">容器命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80"><span class="toc-number">1.9.1.</span> <span class="toc-text">基础</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%AE%B9%E5%99%A8%E5%90%8D%E7%A7%B0"><span class="toc-number">1.9.2.</span> <span class="toc-text">修改容器名称</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E4%BA%A4%E4%BA%92%E5%BC%8F%E5%AE%B9%E5%99%A8"><span class="toc-number">1.9.3.</span> <span class="toc-text">启动交互式容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%97%E5%87%BA%E6%AD%A3%E5%9C%A8%E8%BF%90%E8%A1%8C%E7%9A%84%E5%AE%B9%E5%99%A8"><span class="toc-number">1.9.4.</span> <span class="toc-text">列出正在运行的容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%AE%B9%E5%99%A8"><span class="toc-number">1.9.5.</span> <span class="toc-text">删除容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%AE%B9%E5%99%A8%E6%97%A5%E5%BF%97"><span class="toc-number">1.9.6.</span> <span class="toc-text">查看容器日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%AE%B9%E5%99%A8%E5%86%85%E8%BF%90%E8%A1%8C%E7%9A%84%E8%BF%9B%E7%A8%8B"><span class="toc-number">1.9.7.</span> <span class="toc-text">查看容器内运行的进程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%AE%B9%E5%99%A8%E5%86%85%E9%83%A8%E7%BB%86%E8%8A%82"><span class="toc-number">1.9.8.</span> <span class="toc-text">查看容器内部细节</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E5%85%A5%E6%AD%A3%E5%9C%A8%E8%BF%90%E8%A1%8C%E7%9A%84%E5%AE%B9%E5%99%A8"><span class="toc-number">1.9.9.</span> <span class="toc-text">进入正在运行的容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E6%96%B0%E8%BF%9B%E5%85%A5%E6%AD%A3%E5%9C%A8%E8%BF%90%E8%A1%8C%E7%9A%84%E5%AE%B9%E5%99%A8"><span class="toc-number">1.9.10.</span> <span class="toc-text">重新进入正在运行的容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#exec%E5%92%8Cattch%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">1.9.11.</span> <span class="toc-text">exec和attch的区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E5%92%8C%E5%AE%BF%E4%B8%BB%E6%9C%BA%E6%96%87%E4%BB%B6%E6%8B%B7%E8%B4%9D"><span class="toc-number">1.9.12.</span> <span class="toc-text">容器和宿主机文件拷贝</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E5%92%8C%E5%AF%BC%E5%87%BA%E5%AE%B9%E5%99%A8"><span class="toc-number">1.9.13.</span> <span class="toc-text">导入和导出容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E5%AE%B9%E5%99%A8%E7%94%9F%E6%88%90%E6%96%B0%E7%9A%84%E9%95%9C%E5%83%8F"><span class="toc-number">1.9.14.</span> <span class="toc-text">将容器生成新的镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">1.9.15.</span> <span class="toc-text">容器数据卷</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker%E9%95%9C%E5%83%8F"><span class="toc-number">1.10.</span> <span class="toc-text">Docker镜像</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker%E9%95%9C%E5%83%8F%E5%8A%A0%E8%BD%BD%E5%8E%9F%E7%90%86"><span class="toc-number">1.10.1.</span> <span class="toc-text">Docker镜像加载原理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%81%94%E5%90%88%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.10.1.1.</span> <span class="toc-text">联合文件系统</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#bootfs%E5%92%8Crootfs"><span class="toc-number">1.10.1.2.</span> <span class="toc-text">bootfs和rootfs</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%95%9C%E5%83%8F%E5%88%86%E5%B1%82"><span class="toc-number">1.10.1.3.</span> <span class="toc-text">镜像分层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%95%9C%E5%83%8F%E5%88%86%E5%B1%82%E7%9A%84%E4%BC%98%E5%8A%BF"><span class="toc-number">1.10.1.4.</span> <span class="toc-text">镜像分层的优势</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E5%B1%82"><span class="toc-number">1.10.1.5.</span> <span class="toc-text">容器层</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Registry%E5%BB%BA%E7%AB%8BDocker%E4%BB%93%E5%BA%93"><span class="toc-number">1.11.</span> <span class="toc-text">Registry建立Docker仓库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker-Registry"><span class="toc-number">1.11.1.</span> <span class="toc-text">Docker Registry</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">1.11.2.</span> <span class="toc-text">环境搭建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A8%E9%80%81%E5%88%B0%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93"><span class="toc-number">1.11.3.</span> <span class="toc-text">推送到私有仓库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%BF%E9%87%8C%E4%BA%91%E4%B8%AA%E4%BA%BA%E9%95%9C%E5%83%8F%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93%E4%BD%BF%E7%94%A8"><span class="toc-number">1.11.4.</span> <span class="toc-text">阿里云个人镜像私有仓库使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E9%98%BF%E9%87%8C%E4%BA%91Docker-Registry"><span class="toc-number">1.11.4.1.</span> <span class="toc-text">登录阿里云Docker Registry</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BE%93%E5%85%A5%E5%AF%86%E7%A0%81"><span class="toc-number">1.11.4.2.</span> <span class="toc-text">输入密码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%89%E5%8F%96%E9%95%9C%E5%83%8F"><span class="toc-number">1.11.4.3.</span> <span class="toc-text">拉取镜像</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%86%E9%95%9C%E5%83%8F%E6%89%93%E4%B8%8A%E6%A0%87%E7%AD%BE"><span class="toc-number">1.11.4.4.</span> <span class="toc-text">将镜像打上标签</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%86%E9%95%9C%E5%83%8F%E6%8E%A8%E9%80%81%E5%88%B0Registry"><span class="toc-number">1.11.4.5.</span> <span class="toc-text">将镜像推送到Registry</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker-%E5%AE%89%E8%A3%85-Mysql"><span class="toc-number">1.12.</span> <span class="toc-text">Docker 安装 Mysql</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Mysql-%E5%8D%95%E6%9C%BA"><span class="toc-number">1.12.1.</span> <span class="toc-text">Mysql 单机</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E7%89%88-Mysql-5-7-%E5%AE%89%E8%A3%85"><span class="toc-number">1.12.1.1.</span> <span class="toc-text">简单版 Mysql 5.7 安装</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E7%89%88-Mysql-5-7%E5%AE%89%E8%A3%85"><span class="toc-number">1.12.2.</span> <span class="toc-text">实际应用版 Mysql 5.7安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mysql%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E5%AE%89%E8%A3%85"><span class="toc-number">1.12.3.</span> <span class="toc-text">Mysql主从复制安装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E4%B8%BB%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%B9%E5%99%A8%E5%AE%9E%E4%BE%8B%EF%BC%88%E7%AB%AF%E5%8F%A3%E5%8F%B73307%EF%BC%89%EF%BC%9A"><span class="toc-number">1.12.3.1.</span> <span class="toc-text">安装主服务器容器实例（端口号3307）：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E4%BB%8E%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%B9%E5%99%A8%E5%AE%9E%E4%BE%8B%EF%BC%88%E7%AB%AF%E5%8F%A3%E5%8F%B73308%EF%BC%89%EF%BC%9A"><span class="toc-number">1.12.3.2.</span> <span class="toc-text">安装从服务器容器实例（端口号3308）：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E5%A7%8B%E8%AE%BE%E7%BD%AE%E5%90%8C%E6%AD%A5"><span class="toc-number">1.12.4.</span> <span class="toc-text">开始设置同步</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E4%B8%BB%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.12.4.1.</span> <span class="toc-text">配置主数据库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9B%E5%85%A5%E4%BB%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%B9%E5%99%A8%EF%BC%8C%E9%85%8D%E7%BD%AE%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%EF%BC%9A"><span class="toc-number">1.12.4.2.</span> <span class="toc-text">进入从数据库容器，配置主从复制：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E6%B5%8B%E8%AF%95%EF%BC%9A"><span class="toc-number">1.12.5.</span> <span class="toc-text">主从复制测试：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker%E5%AE%89%E8%A3%85Redis"><span class="toc-number">1.13.</span> <span class="toc-text">Docker安装Redis</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%89%E5%8F%96Redis6-0-8"><span class="toc-number">1.13.1.</span> <span class="toc-text">拉取Redis6.0.8</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E6%9C%BA%E7%89%88%E5%AE%89%E8%A3%85"><span class="toc-number">1.13.2.</span> <span class="toc-text">单机版安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E7%89%88"><span class="toc-number">1.13.3.</span> <span class="toc-text">实际应用版</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Dockerfile"><span class="toc-number">1.14.</span> <span class="toc-text">Dockerfile</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B"><span class="toc-number">1.14.1.</span> <span class="toc-text">构建过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dockerfile%E4%BF%9D%E7%95%99%E5%AD%97"><span class="toc-number">1.14.2.</span> <span class="toc-text">Dockerfile保留字</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#FROM"><span class="toc-number">1.14.2.1.</span> <span class="toc-text">FROM</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MAINTAINER"><span class="toc-number">1.14.2.2.</span> <span class="toc-text">MAINTAINER</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RUN"><span class="toc-number">1.14.2.3.</span> <span class="toc-text">RUN</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#EXPOSE"><span class="toc-number">1.14.2.4.</span> <span class="toc-text">EXPOSE</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#WORKDIR"><span class="toc-number">1.14.2.5.</span> <span class="toc-text">WORKDIR</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#USER"><span class="toc-number">1.14.2.6.</span> <span class="toc-text">USER</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ENV"><span class="toc-number">1.14.2.7.</span> <span class="toc-text">ENV</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#VOLUME"><span class="toc-number">1.14.2.8.</span> <span class="toc-text">VOLUME</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ADD"><span class="toc-number">1.14.2.9.</span> <span class="toc-text">ADD</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#COPY"><span class="toc-number">1.14.2.10.</span> <span class="toc-text">COPY</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CMD"><span class="toc-number">1.14.2.11.</span> <span class="toc-text">CMD</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ENTRYPOINT"><span class="toc-number">1.14.2.12.</span> <span class="toc-text">ENTRYPOINT</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F"><span class="toc-number">1.14.3.</span> <span class="toc-text">构建镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%99%9A%E6%82%AC%E9%95%9C%E5%83%8F-1"><span class="toc-number">1.14.4.</span> <span class="toc-text">虚悬镜像</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker-Desktop-For-Windows-%E5%AE%89%E8%A3%85"><span class="toc-number">1.15.</span> <span class="toc-text">Docker Desktop For Windows 安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85wsl2"><span class="toc-number">1.15.1.</span> <span class="toc-text">安装wsl2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E7%94%A8%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%B9%B3%E5%8F%B0%E5%8A%9F%E8%83%BD"><span class="toc-number">1.15.2.</span> <span class="toc-text">启用虚拟机平台功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86-WSL-%E9%BB%98%E8%AE%A4%E7%89%88%E6%9C%AC%E8%AE%BE%E7%BD%AE%E4%B8%BA-WSL2"><span class="toc-number">1.15.3.</span> <span class="toc-text">将 WSL 默认版本设置为 WSL2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E5%90%AF"><span class="toc-number">1.15.4.</span> <span class="toc-text">重启</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85Ubuntu"><span class="toc-number">1.15.5.</span> <span class="toc-text">安装Ubuntu</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB"><span class="toc-number">1.16.</span> <span class="toc-text">docker数据迁移</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/09/13/%E6%8A%80%E6%9C%AF/%E8%BE%85%E5%8A%A9%E6%8A%80%E8%83%BD/ps/" title="辅助技能"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.godless.site/i/1/2025/05/23/682f5159c1e1f.jpg?_r_=9642d51d-1bea-c10e-8ae1-394f9b309b38" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="辅助技能"/></a><div class="content"><a class="title" href="/2025/09/13/%E6%8A%80%E6%9C%AF/%E8%BE%85%E5%8A%A9%E6%8A%80%E8%83%BD/ps/" title="辅助技能">辅助技能</a><time datetime="2025-09-13T12:31:13.000Z" title="发表于 2025-09-13 20:31:13">2025-09-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/29/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF/element%E4%BF%AE%E6%94%B9%E6%BB%9A%E5%8A%A8%E6%9D%A1/" title="element修改滚动条"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.godless.site/i/1/2025/05/23/682f5159c1e1f.jpg?_r_=1a75329c-3522-1f2c-f1cd-1d1b867a0728" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="element修改滚动条"/></a><div class="content"><a class="title" href="/2025/04/29/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF/element%E4%BF%AE%E6%94%B9%E6%BB%9A%E5%8A%A8%E6%9D%A1/" title="element修改滚动条">element修改滚动条</a><time datetime="2025-04-29T07:53:15.000Z" title="发表于 2025-04-29 15:53:15">2025-04-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/29/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF/%E5%85%B3%E4%BA%8EVue%E4%B8%AD%E6%95%B0%E7%BB%84map%E6%96%B9%E6%B3%95%E7%9A%84%E4%BD%BF%E7%94%A8/" title="关于Vue中数组map方法的使用"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.godless.site/i/1/2025/05/23/682f5159c1e1f.jpg?_r_=83009a14-0906-091b-9ddf-88e63e8b9a12" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="关于Vue中数组map方法的使用"/></a><div class="content"><a class="title" href="/2025/04/29/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF/%E5%85%B3%E4%BA%8EVue%E4%B8%AD%E6%95%B0%E7%BB%84map%E6%96%B9%E6%B3%95%E7%9A%84%E4%BD%BF%E7%94%A8/" title="关于Vue中数组map方法的使用">关于Vue中数组map方法的使用</a><time datetime="2025-04-29T07:53:15.000Z" title="发表于 2025-04-29 15:53:15">2025-04-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/25/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF/%E5%85%B3%E4%BA%8EVue-js%E7%9A%84Devtoos%E6%8F%92%E4%BB%B6%E5%AE%89%E8%A3%85%EF%BC%88%E6%9A%B4%E5%8A%9B%EF%BC%89/" title="关于Vu2的Devtoos插件安装（暴力）"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.godless.site/i/1/2025/05/23/682f5159c1e1f.jpg?_r_=92275ca3-e1de-387f-8b59-ca314164ee15" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="关于Vu2的Devtoos插件安装（暴力）"/></a><div class="content"><a class="title" href="/2025/04/25/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF/%E5%85%B3%E4%BA%8EVue-js%E7%9A%84Devtoos%E6%8F%92%E4%BB%B6%E5%AE%89%E8%A3%85%EF%BC%88%E6%9A%B4%E5%8A%9B%EF%BC%89/" title="关于Vu2的Devtoos插件安装（暴力）">关于Vu2的Devtoos插件安装（暴力）</a><time datetime="2025-04-25T09:34:46.000Z" title="发表于 2025-04-25 17:34:46">2025-04-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/25/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF/%E5%85%B3%E4%BA%8EVue%E7%9A%84%E6%8F%92%E4%BB%B6%E4%BD%BF%E7%94%A8/" title="关于Vue的插件安装、配置、使用"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.godless.site/i/1/2025/05/23/682f52c779f8e.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="关于Vue的插件安装、配置、使用"/></a><div class="content"><a class="title" href="/2025/04/25/%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF/%E5%85%B3%E4%BA%8EVue%E7%9A%84%E6%8F%92%E4%BB%B6%E4%BD%BF%E7%94%A8/" title="关于Vue的插件安装、配置、使用">关于Vue的插件安装、配置、使用</a><time datetime="2025-04-25T03:54:05.000Z" title="发表于 2025-04-25 11:54:05">2025-04-25</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="workboard"><img class="workSituationImg boardsign" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.0.4/img/badge/安知鱼-上班摸鱼中.svg" alt="距离月入25k也就还差一个大佬带我~" title="距离月入25k也就还差一个大佬带我~"/><div id="runtimeTextTip"></div></div></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2024 - 2025 By <a class="footer-bar-link" href="/" title="Godless" target="_blank">Godless</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">21</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">18</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">11</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/TODO/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 任务</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Element/" style="font-size: 0.88rem;">Element<sup>2</sup></a><a href="/tags/Hexo/" style="font-size: 0.88rem;">Hexo<sup>1</sup></a><a href="/tags/Javcascript/" style="font-size: 0.88rem;">Javcascript<sup>1</sup></a><a href="/tags/Linux/" style="font-size: 0.88rem;">Linux<sup>1</sup></a><a href="/tags/Mixin/" style="font-size: 0.88rem;">Mixin<sup>1</sup></a><a href="/tags/PS/" style="font-size: 0.88rem;">PS<sup>1</sup></a><a href="/tags/Picgo/" style="font-size: 0.88rem;">Picgo<sup>1</sup></a><a href="/tags/TMS/" style="font-size: 0.88rem;">TMS<sup>2</sup></a><a href="/tags/Vue/" style="font-size: 0.88rem;">Vue<sup>3</sup></a><a href="/tags/Wxjava/" style="font-size: 0.88rem;">Wxjava<sup>1</sup></a><a href="/tags/docker/" style="font-size: 0.88rem;">docker<sup>1</sup></a><a href="/tags/idea/" style="font-size: 0.88rem;">idea<sup>1</sup></a><a href="/tags/nginx/" style="font-size: 0.88rem;">nginx<sup>1</sup></a><a href="/tags/ruoyi/" style="font-size: 0.88rem;">ruoyi<sup>3</sup></a><a href="/tags/%E5%85%B0%E7%A9%BA%E5%9B%BE%E5%BA%8A/" style="font-size: 0.88rem;">兰空图床<sup>1</sup></a><a href="/tags/%E6%8F%92%E4%BB%B6/" style="font-size: 0.88rem;">插件<sup>1</sup></a><a href="/tags/%E7%BC%96%E8%BE%91%E5%99%A8%E9%85%8D%E7%BD%AE/" style="font-size: 0.88rem;">编辑器配置<sup>2</sup></a><a href="/tags/%E8%8B%A5%E4%BE%9D/" style="font-size: 0.88rem;">若依<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>转为繁体</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.cbd.int/pangu@4.0.7/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("01/9/2024 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2024 By 安知鱼 V1.6.14",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 Godless 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script async="async">(function () {
  var grt = new Date("01/9/2024 00:00:00"); //设置网站上线时间
  var now = new Date();
  var dnum;
  var hnum;
  var mnum;
  var snum;
  var nowHour;

  // 计算并更新天数、小时数、分钟数和秒数
  function updateTime() {
    now = new Date(); // 更新 now 的值
    nowHour = now.getHours(); // 更新 nowHour 的值
    var days = (now - grt) / 1000 / 60 / 60 / 24;
    dnum = Math.floor(days);
    var hours = (now - grt) / 1000 / 60 / 60 - 24 * dnum;
    hnum = Math.floor(hours);
    if (String(hnum).length == 1) {
      hnum = "0" + hnum;
    }
    var minutes = (now - grt) / 1000 / 60 - 24 * 60 * dnum - 60 * hnum;
    mnum = Math.floor(minutes);
    if (String(mnum).length == 1) {
      mnum = "0" + mnum;
    }
    var seconds = (now - grt) / 1000 - 24 * 60 * 60 * dnum - 60 * 60 * hnum - 60 * mnum;
    snum = Math.round(seconds);
    if (String(snum).length == 1) {
      snum = "0" + snum;
    }
  }

  // 更新网页中显示的网站运行时间
  function updateHtml() {
    const footer = document.getElementById("footer");
    if (!footer) return
    let currentTimeHtml = "";
    if (nowHour < 18 && nowHour >= 9) {
      // 如果是上班时间，默认就是"安知鱼-上班摸鱼中.svg"图片，不需要更改
      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    } else {
      // 如果是下班时间，插入"安知鱼-下班啦.svg"图片
      let img = document.querySelector("#workboard .workSituationImg");
      if (img != null) {
        img.src = "https://npm.elemecdn.com/anzhiyu-blog@2.0.4/img/badge/安知鱼-下班啦.svg";
        img.title = "下班了就该开开心心的玩耍，嘿嘿~";
        img.alt = "下班了就该开开心心的玩耍，嘿嘿~";
      }

      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    }

    if (document.getElementById("runtimeTextTip")) {
      document.getElementById("runtimeTextTip").innerHTML = currentTimeHtml;
    }
  }

  setInterval(() => {
    updateTime();
    updateHtml();
  }, 1000);
})();</script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>